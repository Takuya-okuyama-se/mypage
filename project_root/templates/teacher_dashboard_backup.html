{% extends "base.html" %}
{% block title %}è¬›å¸«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | å¡¾è¬›å¸«ã‚µã‚¤ãƒˆ{% endblock %}
{% block head_extra %}
<style>
  .dashboard-container {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
  }
  
  .dashboard-header {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    border: 1px solid #dee2e6;
  }
  
  .dashboard-title {
    color: #333;
    margin-bottom: 10px;
    font-size: 24px;
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .stat-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #dee2e6;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .stat-label {
    color: #666;
    font-size: 14px;
    margin-bottom: 5px;
  }
  
  .stat-value {
    font-size: 32px;
    font-weight: bold;
    color: #333;
  }
  
  .functions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 30px;
  }
  
  .function-link {
    display: block;
    background: white;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #dee2e6;
    text-decoration: none;
    color: #333;
    transition: all 0.3s ease;
    text-align: center;
  }
  
  .function-link:hover {
    background: #f8f9fa;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    text-decoration: none;
    color: #333;
  }
  
  .function-icon {
    font-size: 32px;
    color: #4361ee;
    margin-bottom: 10px;
  }
  
  .function-title {
    font-weight: 600;
    margin-bottom: 5px;
  }
  
  .function-desc {
    font-size: 12px;
    color: #666;
  }
  
  .students-section {
    background: white;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #dee2e6;
  }
  
  .students-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #dee2e6;
  }
  
  .students-title {
    font-size: 20px;
    color: #333;
    margin: 0;
  }
  
  .search-input {
    padding: 8px 12px;
    border: 1px solid #ccc;
    border-radius: 4px;
    width: 200px;
  }
  
  .tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  
  .tab {
    padding: 8px 16px;
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s ease;
  }
  
  .tab:hover {
    background: #e9ecef;
  }
  
  .tab.active {
    background: #4361ee;
    color: white;
    border-color: #4361ee;
  }
  
  .students-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 15px;
  }
  
  .student-card {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 15px;
    transition: all 0.3s ease;
  }
  
  .student-card:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transform: translateY(-2px);
  }
  
  .student-name {
    font-weight: 600;
    margin-bottom: 5px;
    color: #333;
  }
  
  .student-grade {
    color: #666;
    font-size: 14px;
    margin-bottom: 10px;
  }
  
  .student-actions {
    display: flex;
    gap: 8px;
    margin-top: 10px;
  }
  
  .btn-small {
    padding: 6px 12px;
    font-size: 12px;
    border-radius: 4px;
    text-decoration: none;
    cursor: pointer;
    border: none;
    transition: all 0.3s ease;
  }
  
  .btn-primary {
    background: #4361ee;
    color: white;
  }
  
  .btn-primary:hover {
    background: #3a0ca3;
    color: white;
    text-decoration: none;
  }
  
  .btn-secondary {
    background: #6c757d;
    color: white;
  }
  
  .btn-secondary:hover {
    background: #545b62;
    color: white;
    text-decoration: none;
  }
    --text-primary: #ffffff !important;
    --text-secondary: #b0b0c0 !important;
    --text-muted: #808090 !important;
    --glow-shadow: 0 0 20px !important;
    --holographic: linear-gradient(45deg, #ff00ff, #00ffff, #ff00ff) !important;
    --grid-pattern: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0, 255, 255, 0.03) 2px,
      rgba(0, 255, 255, 0.03) 4px
    ) !important;
  }
  
  /* ãƒ™ãƒ¼ã‚¹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ - è¿‘æœªæ¥çš„ãªèƒŒæ™¯ */
  html {
    height: 100% !important;
    overflow: hidden !important;
  }
  
  body {
    background: var(--dark-bg) !important;
    font-family: 'Orbitron', 'Rajdhani', 'Inter', system-ui, sans-serif !important;
    color: var(--text-primary) !important;
    position: relative !important;
    overflow: hidden !important;
    margin: 0 !important;
    padding: 0 !important;
    min-height: 100vh !important;
  }
  
  body::before {
    content: '' !important;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    background: var(--grid-pattern) !important;
    pointer-events: none !important;
    z-index: 1 !important;
  }
  
  /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ« - ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰ */
  /*
  @keyframes float {
    0% { transform: translateY(0) rotate(0deg); opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
  }
  
  .particle {
    position: fixed !important;
    width: 2px !important;
    height: 2px !important;
    background: var(--cyber-primary) !important;
    box-shadow: 0 0 10px var(--cyber-primary) !important;
    animation: float 20s infinite !important;
    z-index: 1 !important;
  }
  */
  
  /* ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ©ãƒƒãƒ‘ãƒ¼ */
  .dashboard-wrapper {
    max-width: 1600px !important;
    margin: 0 auto !important;
    padding: 20px !important;
    position: relative !important;
    z-index: 1000 !important;
    background: transparent !important;
    width: 100% !important;
    height: 100vh !important;
    overflow-y: auto !important; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã«è¨­å®š */
    display: block !important;
    visibility: visible !important;
  }
  
  /* è¿‘æœªæ¥çš„ãªãƒ˜ãƒƒãƒ€ãƒ¼ */
  .dashboard-header {
    background: linear-gradient(135deg, var(--glass-bg) 0%, rgba(0, 255, 255, 0.1) 100%) !important;
    backdrop-filter: blur(10px) !important;
    border: 1px solid var(--glass-border) !important;
    border-radius: 20px !important;
    padding: 30px !important;
    margin-bottom: 30px !important;
    position: relative !important;
    overflow: hidden !important;
    color: var(--text-primary) !important;
  }
  
  .dashboard-header::before {
    content: '' !important;
    position: absolute !important;
    top: -2px !important;
    left: -2px !important;
    right: -2px !important;
    bottom: -2px !important;
    background: var(--holographic) !important;
    border-radius: 20px !important;
    opacity: 0.5 !important;
    z-index: -1 !important;
    /* animation: holographicShift 3s ease-in-out infinite !important; /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰ */
  }
  
  /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰: holographicShift animation
  @keyframes holographicShift {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.7; }
  }
  */
  
  .gradient-title {
    font-size: 36px !important;
    font-weight: 700 !important;
    background: linear-gradient(90deg, var(--cyber-primary), var(--cyber-secondary), var(--cyber-primary)) !important;
    background-size: 200% auto !important;
    background-clip: text !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
    /* animation: shimmer 3s linear infinite !important; /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰ */
    display: flex !important;
    align-items: center !important;
    gap: 15px !important;
    margin: 0 0 10px 0 !important;
    text-transform: uppercase !important;
    letter-spacing: 2px !important;
  }
  
  /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰: shimmer animation
  @keyframes shimmer {
    0% { background-position: 0% center; }
    100% { background-position: 200% center; }
  }
  */
  
  .gradient-icon {
    color: var(--cyber-primary) !important;
    filter: drop-shadow(0 0 10px var(--cyber-primary)) !important;
  }
  
  .welcome-message {
    color: var(--text-secondary) !important;
    font-size: 16px !important;
    letter-spacing: 0.5px !important;
  }
  
  /* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ - ãƒ›ãƒ­ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯åŠ¹æœ */
  .stats-overview {
    display: grid !important;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)) !important;
    gap: 20px !important;
    margin-bottom: 40px !important;
  }
  
  .stat-card {
    background: var(--glass-bg) !important;
    backdrop-filter: blur(10px) !important;
    border: 1px solid var(--glass-border) !important;
    border-radius: 15px !important;
    padding: 25px !important;
    position: relative !important;
    overflow: hidden !important;
    transition: all 0.3s ease !important;
  }
  
  .stat-card::before {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    height: 100% !important;
    background: linear-gradient(180deg, transparent 0%, rgba(0, 255, 255, 0.1) 100%) !important;
    opacity: 0 !important;
    transition: opacity 0.3s ease !important;
  }
  
  /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰: stat-card hover effects
  .stat-card:hover::before {
    opacity: 1 !important;
  }
  
  .stat-card:hover {
    transform: translateY(-5px) !important;
    border-color: var(--cyber-primary) !important;
    box-shadow: 0 10px 30px rgba(0, 255, 255, 0.3) !important;
  }
  */
  
  .stat-icon {
    width: 60px !important;
    height: 60px !important;
    border-radius: 15px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-size: 24px !important;
    margin-bottom: 15px !important;
    position: relative !important;
  }
  
  .stat-card.primary .stat-icon {
    background: linear-gradient(135deg, var(--cyber-primary), var(--neon-blue)) !important;
    box-shadow: var(--glow-shadow) rgba(0, 255, 255, 0.5) !important;
  }
  
  .stat-card.warning .stat-icon {
    background: linear-gradient(135deg, var(--cyber-accent), var(--neon-green)) !important;
    box-shadow: var(--glow-shadow) rgba(255, 255, 0, 0.5) !important;
  }
  
  .stat-card.success .stat-icon {
    background: linear-gradient(135deg, var(--neon-green), var(--cyber-primary)) !important;
    box-shadow: var(--glow-shadow) rgba(0, 255, 136, 0.5) !important;
  }
  
  .stat-card.info .stat-icon {
    background: linear-gradient(135deg, var(--neon-pink), var(--cyber-secondary)) !important;
    box-shadow: var(--glow-shadow) rgba(255, 0, 255, 0.5) !important;
  }
  
  .stat-label {
    font-size: 12px !important;
    font-weight: 600 !important;
    text-transform: uppercase !important;
    letter-spacing: 1px !important;
    color: var(--text-secondary) !important;
    margin-bottom: 5px !important;
  }
  
  .stat-value {
    font-size: 32px !important;
    font-weight: 700 !important;
    color: var(--text-primary) !important;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.5) !important;
    margin-bottom: 10px !important;
  }
  
  .stat-trend {
    font-size: 13px !important;
    font-weight: 500 !important;
    padding: 5px 10px !important;
    border-radius: 20px !important;
    display: inline-flex !important;
    align-items: center !important;
    gap: 5px !important;
  }
  
  .trend-up {
    background: rgba(0, 255, 136, 0.2) !important;
    color: var(--neon-green) !important;
    border: 1px solid rgba(0, 255, 136, 0.3) !important;
  }
  
  .trend-down {
    background: rgba(255, 0, 128, 0.2) !important;
    color: var(--neon-pink) !important;
    border: 1px solid rgba(255, 0, 128, 0.3) !important;
  }
  
  /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ - ãƒã‚ªãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
  .grade-tabs-container, .day-tabs-container {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 25px;
  }
  
  .grade-tabs, .day-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }
  
  .grade-tab, .day-tab {
    padding: 10px 20px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
    font-weight: 500;
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-secondary);
    border: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: hidden;
  }
  
  .grade-tab::before, .day-tab::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: radial-gradient(circle, var(--cyber-primary) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    transition: all 0.3s ease;
  }
  
  /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰: grade-tab and day-tab hover effects
  .grade-tab:hover::before, .day-tab:hover::before {
    width: 100px;
    height: 100px;
  }
  
  .grade-tab:hover, .day-tab:hover {
    color: var(--text-primary);
    transform: translateY(-2px);
  }
  */
  
  .grade-tab.active, .day-tab.active {
    background: linear-gradient(135deg, var(--cyber-primary), var(--neon-blue));
    color: var(--dark-bg);
    font-weight: 600;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
    border: none;
  }
  
  .day-tab.today {
    background: linear-gradient(135deg, var(--cyber-accent), var(--neon-green));
    color: var(--dark-bg);
    box-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
  }
  
  /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ */
  .main-content-area {
    background: var(--glass-bg) !important;
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border) !important;
    border-radius: 20px !important;
    padding: 30px !important;
    margin-bottom: 30px !important;
    color: var(--text-primary) !important;
    display: block !important;
    visibility: visible !important;
    position: relative !important;
    z-index: 100 !important;
    width: 100% !important;
    min-height: auto !important;
  }
  
  .students-header {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    margin-bottom: 30px !important;
    padding-bottom: 20px !important;
    border-bottom: 1px solid var(--glass-border) !important;
  }
  
  .students-title {
    font-size: 24px;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  
  /* æ¤œç´¢æ©Ÿèƒ½ - ãƒã‚ªãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
  .search-filter {
    position: relative;
    width: 100%;
    max-width: 400px;
  }
  
  .search-input {
    width: 100%;
    padding: 12px 20px 12px 45px;
    border-radius: 25px;
    border: 1px solid var(--glass-border);
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-primary);
    font-size: 14px;
    transition: all 0.3s ease;
  }
  
  .search-input:focus {
    border-color: var(--cyber-primary);
    box-shadow: 0 0 0 3px rgba(0, 255, 255, 0.2), inset 0 0 20px rgba(0, 255, 255, 0.1);
    outline: none;
  }
  
  .search-icon {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--cyber-primary);
  }
  
  /* ç”Ÿå¾’ã‚«ãƒ¼ãƒ‰ - 3DåŠ¹æœã¨ãƒ›ãƒ­ã‚°ãƒ©ãƒ  */
  .student-list {
    display: grid !important;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)) !important;
    gap: 25px !important;
    margin-bottom: 30px;
  }
  
  .student-card {
    background: var(--glass-bg) !important;
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border) !important;
    border-radius: 15px !important;
    padding: 25px !important;
    transition: all 0.3s ease !important;
    position: relative;
    overflow: hidden;
    transform-style: preserve-3d;
    perspective: 1000px;
    color: var(--text-primary) !important;
  }
  
  .student-card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: conic-gradient(
      from 0deg at 50% 50%,
      transparent 0deg,
      var(--cyber-primary) 60deg,
      transparent 120deg
    );
    /* animation: rotate 10s linear infinite; /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰ */
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  /* å›è»¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ - ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰
  @keyframes rotate {
    100% { transform: rotate(360deg); }
  }
  */
  
  /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰: student-card hover effects
  .student-card:hover::before {
    opacity: 0.1;
  }
  
  .student-card:hover {
    transform: translateY(-5px) translateZ(20px);
    border-color: var(--cyber-primary);
    box-shadow: 0 10px 40px rgba(0, 255, 255, 0.3);
  }
  */
  
  .student-card.class-day {
    border-color: var(--neon-green);
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.05) 0%, var(--glass-bg) 100%);
  }
  
  .student-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--glass-border);
  }
  
  .student-name {
    font-weight: 600;
    font-size: 18px;
    color: var(--text-primary);
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .student-grade {
    color: var(--cyber-primary);
    font-size: 13px;
    display: inline-block;
    padding: 4px 12px;
    background: rgba(0, 255, 255, 0.1);
    border: 1px solid rgba(0, 255, 255, 0.3);
    border-radius: 20px;
    margin-top: 8px;
  }
  
  /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ - ãƒã‚ªãƒ³ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
  .student-status {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 15px;
    padding: 10px 15px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    border: 1px solid var(--glass-border);
  }
  
  .status-indicator {
    display: inline-block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-right: 8px;
    position: relative;
  }
  
  .status-indicator.status-online {
    background: var(--neon-green);
    box-shadow: 0 0 10px var(--neon-green);
    /* animation: pulse-neon 2s infinite; /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰ */
  }
  
  .status-indicator.status-today {
    background: var(--cyber-accent);
    box-shadow: 0 0 10px var(--cyber-accent);
    /* animation: pulse-neon 2s infinite; /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰ */
  }
  
  .status-indicator.status-offline {
    background: var(--text-muted);
  }
  
  /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰
  @keyframes pulse-neon {
    0% { box-shadow: 0 0 5px currentColor; }
    50% { box-shadow: 0 0 20px currentColor, 0 0 30px currentColor; }
    100% { box-shadow: 0 0 5px currentColor; }
  }
  */
  
  /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ - ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯ã‚¹ã‚¿ã‚¤ãƒ« */
  .student-actions {
    display: flex;
    gap: 15px;
    margin-top: auto;
    padding-top: 15px;
  }
  
  .student-action-btn {
    flex: 1;
    padding: 12px 15px;
    border-radius: 10px;
    border: 1px solid var(--glass-border);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .attendance-btn {
    background: linear-gradient(135deg, var(--cyber-primary), var(--neon-blue));
    color: var(--dark-bg);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
  }
  
  /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰: attendance-btn hover effect
  .attendance-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 30px rgba(0, 255, 255, 0.5);
  }
  */
  
  .detail-btn {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-primary);
    border: 1px solid var(--glass-border);
  }
  
  /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰: detail-btn hover effect
  .detail-btn:hover {
    background: linear-gradient(135deg, var(--cyber-secondary), var(--neon-pink));
    color: var(--dark-bg);
    border: none;
    box-shadow: 0 5px 30px rgba(255, 0, 255, 0.5);
  }
  */
  
  /* ã‚°ãƒ¬ãƒ¼ãƒ‰å‘ä¸Šãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ - è¿‘æœªæ¥UI */
  .grade-improvement-filters {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 30px;
    position: relative;
  }
  
  .modern-filter-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 25px;
    padding: 5px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    width: fit-content;
  }
  
  .filter-tab {
    padding: 10px 20px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
    font-weight: 500;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 8px;
    border: none;
    background: transparent;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .filter-tab:hover {
    color: var(--text-primary);
    background: rgba(255, 255, 255, 0.05);
  }
  
  .filter-tab.active {
    background: linear-gradient(135deg, var(--cyber-primary), var(--neon-blue));
    color: var(--dark-bg);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
  }
  
  /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  - è¿‘æœªæ¥ã‚¹ã‚¿ã‚¤ãƒ« */
  .modern-form-control {
    padding: 12px 15px;
    border: 1px solid var(--glass-border);
    border-radius: 10px;
    font-size: 14px;
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-primary);
    transition: all 0.3s ease;
  }
  
  .modern-form-control:focus {
    border-color: var(--cyber-primary);
    box-shadow: 0 0 0 3px rgba(0, 255, 255, 0.2);
    outline: none;
  }
  
  /* ãƒ‘ãƒãƒ« - ãƒ›ãƒ­ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯åŠ¹æœ */
  .activity-panel, .functions-panel {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
  }
  
  .panel-header {
    font-size: 20px;
    font-weight: 600;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--glass-border);
    margin-bottom: 25px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  
  .panel-header-left {
    display: flex;
    align-items: center;
  }
  
  .panel-header-icon {
    margin-right: 10px;
    font-size: 24px;
    color: var(--cyber-primary);
    filter: drop-shadow(0 0 5px var(--cyber-primary));
  }
  
  /* ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ */
  .theme-toggle-btn {
    background: linear-gradient(135deg, var(--glass-bg), rgba(255, 255, 255, 0.1));
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    color: var(--cyber-primary);
    position: relative;
    overflow: hidden;
  }
  
  .theme-toggle-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, var(--cyber-primary), var(--neon-pink));
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰: theme-toggle-btn hover effects
  .theme-toggle-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
  }
  
  .theme-toggle-btn:hover::before {
    opacity: 0.1;
  }
  */
  
  .theme-toggle-btn i {
    position: relative;
    z-index: 1;
    font-size: 18px;
    transition: all 0.3s ease;
  }
  
  /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰: theme-toggle-btn icon hover effect
  .theme-toggle-btn:hover i {
    color: white;
    filter: drop-shadow(0 0 5px currentColor);
  }
  */
  
  /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  body.dark-mode .theme-toggle-btn i::before {
    content: '\f185'; /* sun icon */
  }
  
  /* ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰æ™‚ã®è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
  body.light-mode {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%) !important;
    color: #333 !important;
  }
  
  body.light-mode .dashboard-container {
    background: rgba(255, 255, 255, 0.95) !important;
    backdrop-filter: blur(10px) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
  }
  
  body.light-mode .header {
    background: rgba(255, 255, 255, 0.9) !important;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
  }
  
  body.light-mode .header h1 {
    color: #333 !important;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1) !important;
  }
  
  body.light-mode .panel {
    background: rgba(255, 255, 255, 0.8) !important;
    border: 1px solid rgba(0, 0, 0, 0.1) !important;
    color: #333 !important;
  }
  
  body.light-mode .panel-header h2 {
    color: #333 !important;
  }
  
  body.light-mode .quick-link {
    background: rgba(255, 255, 255, 0.7) !important;
    border: 1px solid rgba(0, 0, 0, 0.1) !important;
    color: #333 !important;
  }
  
  body.light-mode .quick-link:hover {
    background: rgba(255, 255, 255, 0.9) !important;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
  }
  
  body.light-mode .quick-link h3 {
    color: #333 !important;
  }
  
  body.light-mode .quick-link p {
    color: #666 !important;
  }
  
  body.light-mode .quick-link .icon {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    color: white !important;
  }
  
  body.light-mode .header {
    background: rgba(255, 255, 255, 0.9) !important;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
  }
  
  body.light-mode .header h1 {
    color: #333 !important;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1) !important;
  }
  
  body.light-mode .panel {
    background: rgba(255, 255, 255, 0.8) !important;
    border: 1px solid rgba(0, 0, 0, 0.1) !important;
    color: #333 !important;
  }
  
  body.light-mode .panel-header h2 {
    color: #333 !important;
  }
  
  body.light-mode .quick-link {
    background: rgba(255, 255, 255, 0.7) !important;
    border: 1px solid rgba(0, 0, 0, 0.1) !important;
    color: #333 !important;
  }
  
  body.light-mode .quick-link:hover {
    background: rgba(255, 255, 255, 0.9) !important;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
  }
  
  body.light-mode .quick-link h3 {
    color: #333 !important;
  }
  
  body.light-mode .quick-link p {
    color: #666 !important;
  }
  
  body.light-mode .quick-link .icon {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    color: white !important;
  }
</style>

<!-- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœç”¨ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
<script>
  // æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆã‚’ç„¡åŠ¹åŒ–
  document.addEventListener('DOMContentLoaded', function() {
    console.log('è¿‘æœªæ¥çš„ãƒ†ãƒ¼ãƒã‚’é©ç”¨ä¸­...');
    
    // æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆã‚’å‰Šé™¤
    const styleSheets = document.querySelectorAll('link[rel="stylesheet"]');
    styleSheets.forEach(sheet => {
      if (sheet.href && (sheet.href.includes('style.css') || sheet.href.includes('modern-style.css'))) {
        console.log('æ—¢å­˜ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆã‚’ç„¡åŠ¹åŒ–:', sheet.href);
        sheet.disabled = true;
        sheet.remove();
      }
    });
    
    // bodyã®ã‚¯ãƒ©ã‚¹ã‚’ã™ã¹ã¦å‰Šé™¤
    document.body.className = '';
    document.body.style.cssText = 'background: #0a0a0f !important; color: #ffffff !important; margin: 0 !important; padding: 0 !important; min-height: 100vh !important;';
    
    // è¿‘æœªæ¥ãƒ†ãƒ¼ãƒã®ç¢ºèªã‚’é…å»¶å®Ÿè¡Œ
    setTimeout(() => {
      const futuristicTheme = document.querySelector('.futuristic-theme');
      const dashboardWrapper = document.querySelector('.dashboard-wrapper');
      
      if (futuristicTheme) {
        console.log('è¿‘æœªæ¥çš„ãƒ†ãƒ¼ãƒãŒæ­£å¸¸ã«é©ç”¨ã•ã‚Œã¾ã—ãŸ');
        // è¿½åŠ ã®åˆæœŸåŒ–å‡¦ç†
        initializeThemeEffects();
      } else if (dashboardWrapper) {
        // ã‚¯ãƒ©ã‚¹ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã¯æ‰‹å‹•ã§è¿½åŠ 
        dashboardWrapper.classList.add('futuristic-theme');
        console.log('è¿‘æœªæ¥çš„ãƒ†ãƒ¼ãƒã‚¯ãƒ©ã‚¹ã‚’æ‰‹å‹•ã§è¿½åŠ ã—ã¾ã—ãŸ');
        initializeThemeEffects();
      } else {
        console.warn('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      }
    }, 100);
  });
  
  // ãƒ†ãƒ¼ãƒã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–
  function initializeThemeEffects() {
    // å‹•çš„CSSã®è¿½åŠ 
    addDynamicCSS();
    
    // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¦ç´ ã®ç¢ºèªã¨ãƒ‡ãƒãƒƒã‚°
    const dashboardWrapper = document.querySelector('.dashboard-wrapper');
    const mainContentArea = document.querySelector('.main-content-area');
    const dashboardHeader = document.querySelector('.dashboard-header');
    
    console.log('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¦ç´ ã®çŠ¶æ…‹:');
    console.log('dashboard-wrapper:', dashboardWrapper ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨', dashboardWrapper);
    console.log('main-content-area:', mainContentArea ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨', mainContentArea);
    console.log('dashboard-header:', dashboardHeader ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨', dashboardHeader);
    
    if (dashboardWrapper) {
      const computedStyle = window.getComputedStyle(dashboardWrapper);
      console.log('dashboard-wrapper CSS:', {
        display: computedStyle.display,
        visibility: computedStyle.visibility,
        opacity: computedStyle.opacity,
        zIndex: computedStyle.zIndex,
        position: computedStyle.position
      });
    }
    
    // ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¦ç´ ã®ç¢ºèª
    const gradientElements = document.querySelectorAll('.gradient-title, .stat-card, .dashboard-header');
    if (gradientElements.length > 0) {
      console.log(`${gradientElements.length}å€‹ã®ãƒ†ãƒ¼ãƒè¦ç´ ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ`);
    }
    
    // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœã®ç”Ÿæˆ - ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰
    // createParticles();
  }
  
  // å‹•çš„CSSè¿½åŠ é–¢æ•°
  function addDynamicCSS() {
    const style = document.createElement('style');
    style.textContent = `
      @keyframes float {
        0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
      }
      
      .particle {
        position: fixed !important;
        width: 2px !important;
        height: 2px !important;
        background: #00ffff !important;
        box-shadow: 0 0 10px #00ffff !important;
        /* animation: float 20s linear infinite !important; /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰ */
        z-index: 1 !important;
        pointer-events: none !important;
      }
      
      .futuristic-theme {
        background: #0a0a0f !important;
        color: #ffffff !important;
        min-height: 100vh !important;
      }
      
      /* ç·Šæ€¥ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºä¿®æ­£ - æœ€é«˜å„ªå…ˆåº¦ */
      body, html {
        background: #0a0a0f !important;
        color: #ffffff !important;
        margin: 0 !important;
        padding: 0 !important;
      }
      
      .container,
      body > .container,
      .main-content,
      body > .container > .main-content {
        display: block !important;
        visibility: visible !important;
        position: relative !important;
        opacity: 1 !important;
        z-index: auto !important;
        width: 100% !important;
        height: auto !important;
        min-height: auto !important;
        background: transparent !important;
        margin: 0 !important;
        padding: 0 !important;
      }
      
      /* ãƒ‡ãƒãƒƒã‚°ç”¨: å…¨ã¦ã®ä¸»è¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç¢ºå®Ÿã«è¡¨ç¤º */
      .dashboard-wrapper,
      .main-content-area,
      .dashboard-header,
      .stats-overview,
      .stat-card,
      .gradient-title,
      .welcome-message,
      .stat-label,
      .stat-value {
        display: block !important;
        visibility: visible !important;
        position: relative !important;
        z-index: auto !important;
        opacity: 1 !important;
        color: #ffffff !important;
      }
      
      /* ãƒ†ã‚­ã‚¹ãƒˆã®ç¢ºå®Ÿãªè¡¨ç¤º */
      * {
        color: inherit !important;
      }
      
      .gradient-title {
        background: linear-gradient(90deg, #00ffff, #ff00ff, #00ffff) !important;
        background-clip: text !important;
        -webkit-background-clip: text !important;
        -webkit-text-fill-color: transparent !important;
      }
    `;
    document.head.appendChild(style);
    console.log('å‹•çš„CSSãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ');
    
    // å¼·åˆ¶çš„ã«è¦ç´ ã‚’è¡¨ç¤ºã™ã‚‹è¿½åŠ å‡¦ç†
    setTimeout(() => {
      const elements = document.querySelectorAll('.container, .main-content, .dashboard-wrapper, .main-content-area');
      elements.forEach(el => {
        if (el) {
          el.style.display = 'block';
          el.style.visibility = 'visible';
          el.style.opacity = '1';
          console.log('è¦ç´ ã‚’å¼·åˆ¶è¡¨ç¤º:', el.className);
        }
      });
    }, 100);
  }
  
  // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç”Ÿæˆ - ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰
  function createParticles() {
    // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç”Ÿæˆã‚’ç„¡åŠ¹åŒ–ã—ã¦è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’é˜²æ­¢
    try {
      console.log('ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ã®ãŸã‚ï¼‰');
      return;
    } catch (error) {
      console.error('ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
    }
  }
</script>
{% endblock %}

{% block content %}

<div class="dashboard-wrapper futuristic-theme">
  <div class="main-content-area">
    <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="dashboard-header" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(0, 255, 255, 0.1) 100%) !important; backdrop-filter: blur(10px) !important;">
      <h2 class="gradient-title" style="background: linear-gradient(90deg, #00ffff, #ff00ff, #00ffff) !important; background-clip: text !important; -webkit-background-clip: text !important; -webkit-text-fill-color: transparent !important;">
        <i class="fas fa-tachometer-alt gradient-icon" style="color: #00ffff !important;"></i>
        è¬›å¸«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
      </h2>
      <p class="welcome-message" style="color: #b0b0c0 !important;">ã“ã‚“ã«ã¡ã¯ã€{{ name }}å…ˆç”Ÿã€‚ä»Šæ—¥ã‚‚ç”Ÿå¾’ãŸã¡ã®æˆé•·ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã—ã‚‡ã†ã€‚</p>
    </div>

    <!-- çµ±è¨ˆæ¦‚è¦ -->
    <div class="stats-overview">
      <div class="stat-card primary">
        <div class="stat-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <div class="stat-label">ç™»éŒ²ç”Ÿå¾’æ•°</div>
          <div class="stat-value">{{ student_count }}</div>
          <div class="stat-trend trend-up">
            <span class="trend-icon">â†—</span>
            <span>å…ˆæœˆæ¯” 3äººå¢—</span>
          </div>
        </div>
      </div>

      <div class="stat-card warning">
        <div class="stat-icon">
          <i class="fas fa-file-alt"></i>
        </div>
        <div class="stat-content">
          <div class="stat-label">ä»Šæœˆã®æ¨¡è©¦</div>
          <div class="stat-value">2</div>
          <div class="stat-trend">
            <span>æ¬¡å›ï¼š5/20</span>
          </div>
        </div>
      </div>

      <div class="stat-card success">
        <div class="stat-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="stat-content">
          <div class="stat-label">å‡ºå¸­ç‡</div>
          <div class="stat-value">94%</div>
          <div class="stat-trend trend-up">
            <span class="trend-icon">â†—</span>
            <span>å…ˆé€±æ¯” 2%å¢—</span>
          </div>
        </div>
      </div>

      <div class="stat-card info">
        <div class="stat-icon">
          <i class="fas fa-user-plus"></i>
        </div>
        <div class="stat-content">
          <div class="stat-label">æ–°è¦ç™»éŒ²</div>
          <div class="stat-value">3</div>
          <div class="stat-trend">
            <span>ä»Šæœˆ</span>
          </div>
        </div>
      </div>
    </div>

    <!-- æˆç¸¾å‘ä¸Šãƒ•ã‚£ãƒ«ã‚¿ -->
    <div class="grade-improvement-filters">
      <div class="card-header">
        <h4 class="section-title">
          <i class="fas fa-filter"></i>
          æˆç¸¾å‘ä¸Šãƒ•ã‚£ãƒ«ã‚¿
        </h4>
      </div>
      <div class="card-content">
        <!-- ãƒ•ã‚£ãƒ«ã‚¿ã‚¿ãƒ– -->
        <div class="modern-filter-tabs">
          <div class="filter-tab active" data-filter="elementary">
            <i class="fas fa-child"></i>
            <span>å°å­¦ç”Ÿæˆç¸¾</span>
          </div>
          <div class="filter-tab" data-filter="middle">
            <i class="fas fa-graduation-cap"></i>
            <span>ä¸­å­¦ç”Ÿå†…ç”³</span>
          </div>
        </div>
        
        <!-- å°å­¦ç”Ÿãƒ•ã‚£ãƒ«ã‚¿ -->
        <div id="elementary-filter" class="filter-panel active">
          <div class="modern-form-row">
            <div class="modern-form-group">
              <label class="modern-form-label">
                <i class="fas fa-calendar-alt"></i>
                é–‹å§‹æœˆ
              </label>
              <select id="elementary-start-month" class="modern-form-control">
                <option value="4">4æœˆ</option>
                <option value="5">5æœˆ</option>
                <option value="6">6æœˆ</option>
                <option value="7">7æœˆ</option>
                <option value="8">8æœˆ</option>
                <option value="9">9æœˆ</option>
                <option value="10">10æœˆ</option>
                <option value="11">11æœˆ</option>
                <option value="12">12æœˆ</option>
                <option value="1">1æœˆ</option>
                <option value="2">2æœˆ</option>
                <option value="3">3æœˆ</option>
              </select>
            </div>
            <div class="modern-form-group">
              <label class="modern-form-label">
                <i class="fas fa-calendar-check"></i>
                çµ‚äº†æœˆ
              </label>
              <select id="elementary-end-month" class="modern-form-control">
                <option value="4">4æœˆ</option>
                <option value="5">5æœˆ</option>
                <option value="6">6æœˆ</option>
                <option value="7">7æœˆ</option>
                <option value="8">8æœˆ</option>
                <option value="9">9æœˆ</option>
                <option value="10">10æœˆ</option>
                <option value="11">11æœˆ</option>
                <option value="12">12æœˆ</option>
                <option value="1">1æœˆ</option>
                <option value="2">2æœˆ</option>
                <option value="3">3æœˆ</option>
              </select>
            </div>
            <div class="modern-form-group">
              <label class="modern-form-label">ç§‘ç›®</label>
              <select id="elementary-subject" class="modern-form-control">
                <option value="all">å…¨ç§‘ç›®</option>
                <option value="1">å›½èª</option>
                <option value="2">ç®—æ•°</option>
                <option value="3">è‹±èª</option>
              </select>
            </div>
            <div class="modern-form-group">
              <label class="modern-form-label">æœ€å°å‘ä¸Šç‚¹æ•°</label>
              <select id="elementary-min-improvement" class="modern-form-control">
                <option value="0">å…¨ã¦è¡¨ç¤º</option>
                <option value="5">5ç‚¹ä»¥ä¸Š</option>
                <option value="10">10ç‚¹ä»¥ä¸Š</option>
                <option value="15">15ç‚¹ä»¥ä¸Š</option>
              </select>
            </div>
            <div class="modern-form-group">
              <button id="elementary-filter-btn" class="btn btn-primary">ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨</button>
            </div>
          </div>
        </div>
        
        <!-- ä¸­å­¦ç”Ÿãƒ•ã‚£ãƒ«ã‚¿ -->
        <div id="middle-filter" class="filter-panel">
          <div class="modern-form-row">
            <div class="modern-form-group">
              <label class="modern-form-label">é–‹å§‹å¹´</label>
              <select id="middle-start-year" class="modern-form-control">
                <option value="1">1å¹´</option>
                <option value="2">2å¹´</option>
                <option value="3">3å¹´</option>
              </select>
            </div>
            <div class="modern-form-group">
              <label class="modern-form-label">é–‹å§‹å­¦æœŸ</label>
              <select id="middle-start-term" class="modern-form-control">
                <option value="1">1å­¦æœŸ</option>
                <option value="2">2å­¦æœŸ</option>
                <option value="3">3å­¦æœŸ</option>
              </select>
            </div>
            <div class="modern-form-group">
              <label class="modern-form-label">çµ‚äº†å¹´</label>
              <select id="middle-end-year" class="modern-form-control">
                <option value="1">1å¹´</option>
                <option value="2">2å¹´</option>
                <option value="3">3å¹´</option>
              </select>
            </div>
            <div class="modern-form-group">
              <label class="modern-form-label">çµ‚äº†å­¦æœŸ</label>
              <select id="middle-end-term" class="modern-form-control">
                <option value="1">1å­¦æœŸ</option>
                <option value="2">2å­¦æœŸ</option>
                <option value="3">3å­¦æœŸ</option>
              </select>
            </div>
            <div class="modern-form-group">
              <label class="modern-form-label">ç§‘ç›®</label>
              <select id="middle-subject" class="modern-form-control">
                <option value="all">å…¨ç§‘ç›®</option>
                <option value="1">å›½èª</option>
                <option value="2">æ•°å­¦</option>
                <option value="3">è‹±èª</option>
                <option value="4">ç†ç§‘</option>
                <option value="5">ç¤¾ä¼š</option>
                <option value="6">éŸ³æ¥½</option>
                <option value="7">ç¾è¡“</option>
                <option value="8">ä¿ä½“</option>
                <option value="9">æŠ€å®¶</option>
              </select>
            </div>
            <div class="modern-form-group">
              <button id="middle-filter-btn" class="btn btn-primary">ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ã‚°ãƒ©ãƒ•ã¨åˆ†æ -->
    <div class="analytics-panel">
      <h4 class="analytics-title">å­¦ç¿’çŠ¶æ³åˆ†æ</h4>
      <div class="charts-row">
        <div class="chart-container">
          <div class="chart-header">
            <h5 class="chart-title">å­¦å¹´åˆ¥å‡ºå¸­ç‡</h5>
            <span class="chart-period">ç›´è¿‘30æ—¥é–“</span>
          </div>
          <div class="chart-placeholder" style="flex-grow: 1; display: flex; justify-content: center; align-items: center; background: rgba(0, 255, 255, 0.05); border-radius: 10px; border: 1px solid rgba(0, 255, 255, 0.2);">
            <p style="color: var(--cyber-primary); font-size: 14px;">å‡ºå¸­ç‡ã‚°ãƒ©ãƒ•ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
          </div>
        </div>
        
        <div class="chart-container">
          <div class="chart-header">
            <h5 class="chart-title">æ¨¡è©¦å¹³å‡ç‚¹æ¨ç§»</h5>
            <span class="chart-period">éå»6å›åˆ†</span>
          </div>
          <div class="chart-placeholder" style="flex-grow: 1; display: flex; justify-content: center; align-items: center; background: rgba(255, 0, 255, 0.05); border-radius: 10px; border: 1px solid rgba(255, 0, 255, 0.2);">
            <p style="color: var(--cyber-secondary); font-size: 14px;">æ¨¡è©¦ã‚¹ã‚³ã‚¢ã‚°ãƒ©ãƒ•ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ç”Ÿå¾’ä¸€è¦§ -->
    <div class="students-panel">
      <div class="students-header">
        <h4 class="students-title">å­¦å¹´åˆ¥ç”Ÿå¾’ç®¡ç†</h4>
        <div style="display: flex; gap: 15px; align-items: center;">
          <button id="grade-schedule-btn" class="btn btn-outline-primary">å­¦å¹´åˆ¥æ›œæ—¥è¨­å®š</button>
          <div class="search-filter">
            <span class="search-icon">ğŸ”</span>
            <input type="text" class="search-input" placeholder="ç”Ÿå¾’ã‚’æ¤œç´¢..." id="student-search">
          </div>
        </div>
      </div>
      
      <div class="grade-tabs-container">
        <div class="grade-tabs">
          <div class="grade-tab active" data-grade="all">å…¨å­¦å¹´</div>
          <div class="grade-tab" data-grade="elementary">å°å­¦ç”Ÿ</div>
          <div class="grade-tab" data-grade="middle">ä¸­å­¦ç”Ÿ</div>
          <div class="grade-tab" data-grade="high">é«˜æ ¡ç”Ÿ</div>
          <div class="grade-tab" data-grade="unset">æœªè¨­å®š</div>
          <!-- å°å­¦ç”Ÿã®å­¦å¹´ -->
          <div class="grade-tab elementary-grade" data-grade="elementary-1">å°1</div>
          <div class="grade-tab elementary-grade" data-grade="elementary-2">å°2</div>
          <div class="grade-tab elementary-grade" data-grade="elementary-3">å°3</div>
          <div class="grade-tab elementary-grade" data-grade="elementary-4">å°4</div>
          <div class="grade-tab elementary-grade" data-grade="elementary-5">å°5</div>
          <div class="grade-tab elementary-grade" data-grade="elementary-6">å°6</div>
          <!-- ä¸­å­¦ç”Ÿã®å­¦å¹´ -->
          <div class="grade-tab middle-grade" data-grade="middle-1">ä¸­1</div>
          <div class="grade-tab middle-grade" data-grade="middle-2">ä¸­2</div>
          <div class="grade-tab middle-grade" data-grade="middle-3">ä¸­3</div>
          <!-- é«˜æ ¡ç”Ÿã®å­¦å¹´ -->
          <div class="grade-tab high-grade" data-grade="high-1">é«˜1</div>
          <div class="grade-tab high-grade" data-grade="high-2">é«˜2</div>
          <div class="grade-tab high-grade" data-grade="high-3">é«˜3</div>
        </div>
      </div>
      
      <!-- æ›œæ—¥ã‚¿ãƒ– -->
      <div class="day-tabs-container">
        <div class="day-tabs">
          <div class="day-tab active" data-day="all">å…¨æ›œæ—¥</div>
          <div class="day-tab" data-day="0">æ—¥æ›œæ—¥</div>
          <div class="day-tab" data-day="1">æœˆæ›œæ—¥</div>
          <div class="day-tab" data-day="2">ç«æ›œæ—¥</div>
          <div class="day-tab" data-day="3">æ°´æ›œæ—¥</div>
          <div class="day-tab" data-day="4">æœ¨æ›œæ—¥</div>
          <div class="day-tab" data-day="5">é‡‘æ›œæ—¥</div>
          <div class="day-tab" data-day="6">åœŸæ›œæ—¥</div>
          <div class="day-tab" data-day="today">æœ¬æ—¥</div>
        </div>
      </div>
      
      <div class="student-list students-grid" id="student-list">
        <!-- ç”Ÿå¾’ã‚«ãƒ¼ãƒ‰ã¯å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
      </div>
      
      <div class="attendance-footer">
        <button id="attendance-check-btn" class="btn btn-primary">ä¸€æ‹¬å‡ºå¸­ç¢ºèª</button>
      </div>
    </div>
  </div>
  
  <div class="side-panels">
    <!-- æœ€è¿‘ã®æ´»å‹• -->
    <div class="activity-panel">
      <h4 class="panel-header">
        <span class="panel-header-icon">ğŸ“‹</span>
        æœ€è¿‘ã®æ´»å‹•
      </h4>
      <ul class="activity-list">
        <li class="activity-item">
          <div class="activity-content">é«˜æ ¡æƒ…å ±ã€Œæ¨ªæµœç¿ åµé«˜æ ¡ã€ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ</div>
          <div class="activity-date">2025-05-05 14:23</div>
        </li>
        <li class="activity-item">
          <div class="activity-content">æ–°ã—ã„ãŠçŸ¥ã‚‰ã›ãŒç™»éŒ²ã•ã‚Œã¾ã—ãŸï¼šã€Œ6æœˆã®æ¨¡è©¦ã«ã¤ã„ã¦ã€</div>
          <div class="activity-date">2025-05-03 09:15</div>
        </li>
        <li class="activity-item">
          <div class="activity-content">ç”Ÿå¾’ã€Œå±±ç”°å¤ªéƒã€ã•ã‚“ãŒæˆç¸¾ã‚’æ›´æ–°ã—ã¾ã—ãŸ</div>
          <div class="activity-date">2025-05-01 16:30</div>
        </li>
      </ul>
    </div>
    
    <!-- ä¸»ãªæ©Ÿèƒ½ -->
    <div class="functions-panel">
      <h4 class="panel-header">
        <span class="panel-header-icon">âš¡</span>
        ä¸»ãªæ©Ÿèƒ½
        <button id="theme-toggle" class="theme-toggle-btn" aria-label="ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ" title="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ">
          <i class="fas fa-moon"></i>
        </button>
      </h4>
      <div class="quick-links">
        <a href="/myapp/index.cgi/teacher/points" class="quick-link" aria-label="ãƒã‚¤ãƒ³ãƒˆç®¡ç†">
          <div class="icon"><i class="fas fa-coins"></i></div>
          <div class="title">ãƒã‚¤ãƒ³ãƒˆç®¡ç†</div>
          <div class="description">ç”Ÿå¾’ã¸ã®ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ãƒ»å±¥æ­´ç®¡ç†</div>
        </a>
        
        <a href="/myapp/index.cgi/teacher/crane-game-credits" class="quick-link" aria-label="ã‚¯ãƒ¬ãƒ¼ãƒ³ã‚²ãƒ¼ãƒ ç®¡ç†">
          <div class="icon"><i class="fas fa-gamepad"></i></div>
          <div class="title">ã‚¯ãƒ¬ãƒ¼ãƒ³ã‚²ãƒ¼ãƒ </div>
          <div class="description">ãƒ—ãƒ¬ã‚¤æ¨©ã®ç®¡ç†ã¨è¨­å®š</div>
        </a>
        
        <a href="/myapp/index.cgi/teacher/manual-score" class="quick-link" aria-label="å°å­¦ç”Ÿç‚¹æ•°ç™»éŒ²">
          <div class="icon"><i class="fas fa-edit"></i></div>
          <div class="title">å°å­¦ç”Ÿç‚¹æ•°</div>
          <div class="description">å¤–éƒ¨ãƒ†ã‚¹ãƒˆç‚¹æ•°ã®ç™»éŒ²</div>
        </a>
        
        <a href="/myapp/index.cgi/admin/fetch-high-schools" class="quick-link" aria-label="é«˜æ ¡æƒ…å ±ç®¡ç†">
          <div class="icon"><i class="fas fa-school"></i></div>
          <div class="title">é«˜æ ¡æƒ…å ±</div>
          <div class="description">é«˜æ ¡ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ãƒ»ç®¡ç†</div>
        </a>
        
        <a href="/myapp/index.cgi/teacher/attendance" class="quick-link" aria-label="å‡ºå¸­ç®¡ç†">
          <div class="icon"><i class="fas fa-calendar-check"></i></div>
          <div class="title">å‡ºå¸­ç®¡ç†</div>
          <div class="description">ç”Ÿå¾’ã®å‡ºå¸­çŠ¶æ³ç¢ºèª</div>
        </a>
        
        <a href="/myapp/index.cgi/teacher/homework" class="quick-link highlight" aria-label="å®¿é¡Œç®¡ç†ï¼ˆãŠã™ã™ã‚ï¼‰">
          <div class="icon"><i class="fas fa-book-open"></i></div>
          <div class="title">å®¿é¡Œç®¡ç†</div>
          <div class="description">å°5ãƒ»å°6ã®å®¿é¡Œç™»éŒ²ã¨ãƒã‚§ãƒƒã‚¯</div>
        </a>
      </div>
    </div>
  </div>
</div>

<!-- å‡ºå¸­ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="attendance-modal" class="attendance-modal">
  <div class="attendance-modal-content">
    <span class="attendance-close">&times;</span>
    <h4>å‡ºå¸­ç¢ºèª</h4>
    <div class="attendance-date">
      <label for="attendance-date-input">æ—¥ä»˜ï¼š</label>
      <input type="date" id="attendance-date-input" class="modern-form-control" value="">
    </div>

    <div class="attendance-list" id="attendance-list">
      <!-- å‡ºå¸­ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
    </div>

    <div class="attendance-submit">
      <button id="attendance-submit-btn" class="btn btn-primary">å‡ºå¸­æƒ…å ±ã‚’ä¿å­˜</button>
    </div>
  </div>
</div>

<!-- å­¦å¹´åˆ¥æ›œæ—¥è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="grade-schedule-modal" class="grade-schedule-modal">
  <div class="grade-schedule-modal-content">
    <span class="grade-schedule-close">&times;</span>
    <h4>å­¦å¹´åˆ¥æ›œæ—¥è¨­å®š</h4>
    <div class="alert alert-info" style="background: rgba(0, 255, 255, 0.1); border: 1px solid rgba(0, 255, 255, 0.3); color: var(--text-primary); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
      å„å­¦å¹´ã®æˆæ¥­æ—¥ã¨ã—ã¦è¨­å®šã•ã‚Œã¦ã„ã‚‹æ›œæ—¥ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç”Ÿå¾’ã®å‡ºå¸­ç®¡ç†ãŒç°¡å˜ã«ãªã‚Šã¾ã™ã€‚å‡ºå¸­æ™‚ã«æˆæ¥­æ—¥ã§ã‚ã‚Œã°ã€è‡ªå‹•çš„ã«ãƒã‚¤ãƒ³ãƒˆãŒä»˜ä¸ã•ã‚Œã¾ã™ã€‚
    </div>

    <table class="schedule-table" style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th style="padding: 15px; background: rgba(0, 255, 255, 0.1); color: var(--cyber-primary); border: 1px solid var(--glass-border);">å­¦å¹´</th>
          <th style="padding: 15px; background: rgba(0, 255, 255, 0.1); color: var(--cyber-primary); border: 1px solid var(--glass-border);">æœˆ</th>
          <th style="padding: 15px; background: rgba(0, 255, 255, 0.1); color: var(--cyber-primary); border: 1px solid var(--glass-border);">ç«</th>
          <th style="padding: 15px; background: rgba(0, 255, 255, 0.1); color: var(--cyber-primary); border: 1px solid var(--glass-border);">æ°´</th>
          <th style="padding: 15px; background: rgba(0, 255, 255, 0.1); color: var(--cyber-primary); border: 1px solid var(--glass-border);">æœ¨</th>
          <th style="padding: 15px; background: rgba(0, 255, 255, 0.1); color: var(--cyber-primary); border: 1px solid var(--glass-border);">é‡‘</th>
          <th style="padding: 15px; background: rgba(0, 255, 255, 0.1); color: var(--cyber-primary); border: 1px solid var(--glass-border);">åœŸ</th>
          <th style="padding: 15px; background: rgba(0, 255, 255, 0.1); color: var(--cyber-primary); border: 1px solid var(--glass-border);">æ—¥</th>
        </tr>
      </thead>
      <tbody id="grade-schedule-tbody">
        <!-- å„å­¦å¹´ã®è¡Œ -->
        <tr data-grade="elementary-1">
          <td style="padding: 15px; border: 1px solid var(--glass-border); color: var(--text-primary);">å°1</td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="1"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="2"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="3"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="4"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="5"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="6"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="0"></td>
        </tr>
        <tr data-grade="elementary-2">
          <td style="padding: 15px; border: 1px solid var(--glass-border); color: var(--text-primary);">å°2</td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="1"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="2"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="3"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="4"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="5"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="6"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="0"></td>
        </tr>
        <tr data-grade="elementary-3">
          <td style="padding: 15px; border: 1px solid var(--glass-border); color: var(--text-primary);">å°3</td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="1"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="2"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="3"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="4"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="5"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="6"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="0"></td>
        </tr>
        <tr data-grade="elementary-4">
          <td style="padding: 15px; border: 1px solid var(--glass-border); color: var(--text-primary);">å°4</td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="1"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="2"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="3"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="4"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="5"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="6"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="0"></td>
        </tr>
        <tr data-grade="elementary-5">
          <td style="padding: 15px; border: 1px solid var(--glass-border); color: var(--text-primary);">å°5</td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="1"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="2"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="3"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="4"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="5"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="6"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="0"></td>
        </tr>
        <tr data-grade="elementary-6">
          <td style="padding: 15px; border: 1px solid var(--glass-border); color: var(--text-primary);">å°6</td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="1"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="2"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="3"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="4"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="5"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="6"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="0"></td>
        </tr>
        <tr data-grade="middle-1">
          <td style="padding: 15px; border: 1px solid var(--glass-border); color: var(--text-primary);">ä¸­1</td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="1"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="2"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="3"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="4"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="5"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="6"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="0"></td>
        </tr>
        <tr data-grade="middle-2">
          <td style="padding: 15px; border: 1px solid var(--glass-border); color: var(--text-primary);">ä¸­2</td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="1"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="2"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="3"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="4"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="5"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="6"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="0"></td>
        </tr>
        <tr data-grade="middle-3">
          <td style="padding: 15px; border: 1px solid var(--glass-border); color: var(--text-primary);">ä¸­3</td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="1"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="2"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="3"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="4"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="5"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="6"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="0"></td>
        </tr>
        <tr data-grade="high-1">
          <td style="padding: 15px; border: 1px solid var(--glass-border); color: var(--text-primary);">é«˜1</td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="1"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="2"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="3"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="4"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="5"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="6"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="0"></td>
        </tr>
        <tr data-grade="high-2">
          <td style="padding: 15px; border: 1px solid var(--glass-border); color: var(--text-primary);">é«˜2</td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="1"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="2"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="3"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="4"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="5"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="6"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="0"></td>
        </tr>
        <tr data-grade="high-3">
          <td style="padding: 15px; border: 1px solid var(--glass-border); color: var(--text-primary);">é«˜3</td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="1"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="2"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="3"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="4"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="5"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="6"></td>
          <td style="padding: 15px; border: 1px solid var(--glass-border); text-align: center;"><input type="checkbox" data-day="0"></td>
        </tr>
      </tbody>
    </table>

    <div class="grade-schedule-footer" style="margin-top: 25px; text-align: right;">
      <button id="grade-schedule-save-btn" class="btn btn-primary">è¨­å®šã‚’ä¿å­˜</button>
    </div>
  </div>
</div>

<!-- ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ã‚¹ã‚¿ã‚¤ãƒ«è¿½åŠ  -->
<style>
  input[type="checkbox"] {
    appearance: none;
    width: 20px;
    height: 20px;
    border: 2px solid var(--glass-border);
    border-radius: 5px;
    background: transparent;
    cursor: pointer;
    position: relative;
    transition: all 0.3s ease;
  }
  
  input[type="checkbox"]:checked {
    background: var(--cyber-primary);
    border-color: var(--cyber-primary);
    box-shadow: 0 0 10px var(--cyber-primary);
  }
  
  input[type="checkbox"]:checked::after {
    content: 'âœ“';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--dark-bg);
    font-weight: bold;
  }
  
  /* ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ«ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ */
  .side-panels {
    display: flex;
    flex-direction: column;
    gap: 30px;
    max-width: 1600px;
    margin: 0 auto;
    padding: 0 20px;
  }
  
  @media (min-width: 1200px) {
    .side-panels {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }
  }
  
  /* ãƒ•ã‚©ãƒ¼ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
  .modern-form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 20px;
    align-items: end;
  }
  
  .modern-form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  .modern-form-label {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  /* å‡ºå¸­ãƒªã‚¹ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
  .attendance-list {
    max-height: 400px;
    overflow-y: auto;
    margin: 25px 0;
    padding: 20px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    border: 1px solid var(--glass-border);
  }
  
  .attendance-row {
    display: flex;
    align-items: center;
    padding: 15px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    margin-bottom: 10px;
    transition: all 0.3s ease;
    border: 1px solid var(--glass-border);
  }
  
  /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰: attendance-row hover effect
  .attendance-row:hover {
    background: rgba(0, 255, 255, 0.05);
    border-color: var(--cyber-primary);
  }
  */
  
  .attendance-student-name {
    flex: 1;
    font-weight: 500;
    color: var(--text-primary);
    font-size: 15px;
  }
  
  .attendance-options {
    display: flex;
    gap: 20px;
  }
  
  .attendance-option {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-size: 14px;
    color: var(--text-secondary);
    transition: all 0.3s ease;
  }
  
  /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰: attendance-option hover effect
  .attendance-option:hover {
    color: var(--text-primary);
  }
  */
  
  .attendance-option input[type="radio"] {
    appearance: none;
    width: 16px;
    height: 16px;
    border: 2px solid var(--glass-border);
    border-radius: 50%;
    margin-right: 8px;
    cursor: pointer;
    position: relative;
    transition: all 0.3s ease;
  }
  
  .attendance-option input[type="radio"]:checked {
    border-color: var(--cyber-primary);
    box-shadow: 0 0 10px var(--cyber-primary);
  }
  
  .attendance-option input[type="radio"]:checked::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--cyber-primary);
  }
  
  .point-hint {
    color: var(--neon-green);
    font-weight: bold;
    font-size: 12px;
    margin-left: 5px;
  }
</style>
{% endblock %}

{% block scripts %}
<!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–ã¨ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ -->
<script>
// ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', function() {
  // æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¼·åˆ¶çš„ã«ç„¡åŠ¹åŒ–
  const existingStyles = document.querySelectorAll('link[href*="style.css"], link[href*="modern-style.css"]');
  existingStyles.forEach(link => {
    link.disabled = true;
    link.remove();
  });
  
  // ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è¦ç´ ã‚’ç¢ºå®Ÿã«éè¡¨ç¤º
  const hideElements = document.querySelectorAll('body > header, body > nav, body > footer');
  hideElements.forEach(el => {
    if (el) {
      el.style.display = 'none';
      el.style.visibility = 'hidden';
      el.style.position = 'absolute';
      el.style.top = '-9999px';
      el.style.left = '-9999px';
      el.style.overflow = 'hidden';
      el.style.height = '0';
      el.style.opacity = '0';
    }
  });
  
  // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœã®ç”Ÿæˆ - ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰
  // createParticles();
  
  // ãƒã‚ªãƒ³åŠ¹æœã®åˆæœŸåŒ–
  initNeonEffects();
});

// ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœã®ç”Ÿæˆé–¢æ•° - ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰
function createParticles() {
  // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç”Ÿæˆã‚’ç„¡åŠ¹åŒ–ã—ã¦è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’é˜²æ­¢
  return;
}

// ãƒã‚ªãƒ³åŠ¹æœã®åˆæœŸåŒ–
function initNeonEffects() {
  const glowElements = document.querySelectorAll('.stat-card, .dashboard-header, .grade-tab, .day-tab');
  glowElements.forEach(el => {
    if (el) {
      el.style.transition = 'all 0.3s ease';
    }
  });
}

// æ—¢å­˜ã®JavaScriptã‚³ãƒ¼ãƒ‰
// Quick Linksã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–åŠ¹æœ
const quickLinks = document.querySelectorAll('.quick-link');

quickLinks.forEach(link => {
    // ãƒã‚¦ã‚¹è¿½å¾“3DåŠ¹æœ - ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰
    /*
    link.addEventListener('mousemove', function(e) {
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
        
        const rect = this.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        
        const rotateX = (y - centerY) / 10;
        const rotateY = (centerX - x) / 10;
        
        this.style.transform = `
            perspective(1000px) 
            rotateX(${rotateX}deg) 
            rotateY(${rotateY}deg) 
            translateZ(10px)
            scale(1.02)
        `;
    });
    
    link.addEventListener('mouseleave', function() {
        this.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) translateZ(0) scale(1)';
    });
    */
    
    // ãƒªãƒƒãƒ—ãƒ«åŠ¹æœ
    link.addEventListener('click', function(e) {
        const ripple = document.createElement('div');
        const rect = this.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        const x = e.clientX - rect.left - size / 2;
        const y = e.clientY - rect.top - size / 2;
        
        ripple.style.cssText = `
            position: absolute;
            width: ${size}px;
            height: ${size}px;
            left: ${x}px;
            top: ${y}px;
            background: radial-gradient(circle, rgba(0, 255, 255, 0.6) 0%, transparent 70%);
            border-radius: 50%;
            transform: scale(0);
            /* animation: rippleEffect 0.6s linear; /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰ */
            pointer-events: none;
            z-index: 1000;
        `;
        
        this.style.position = 'relative';
        this.style.overflow = 'hidden';
        this.appendChild(ripple);
        
        setTimeout(() => {
            ripple.remove();
        }, 600);
    });
});

// ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¦–å·®åŠ¹æœ - ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰
function handleScroll() {
    // è¦–å·®åŠ¹æœã‚’ç„¡åŠ¹åŒ–ã—ã¦è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’é˜²æ­¢
    return;
}

// ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ç„¡åŠ¹åŒ–
// let ticking = false;
// window.addEventListener('scroll', function() {
//     if (!ticking) {
//         requestAnimationFrame(function() {
//             handleScroll();
//             ticking = false;
//         });
//         ticking = true;
//     }
// });

// CSS keyframes for ripple effect - ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰
const style = document.createElement('style');
style.textContent = `
    /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰: rippleEffect animation
    @keyframes rippleEffect {
        to {
            transform: scale(4);
            opacity: 0;
        }
    }
    */
`;
document.head.appendChild(style);
</script>
<script>
  // ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹é–¢æ•° - ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã€ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’æ”¹å–„
  function fetchStudents(filters = {}) {
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨­å®š
    const defaultFilters = {
      grade: 'all',
      day: 'all'  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¨æ›œæ—¥ã«è¨­å®š
    };
    
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã¨ãƒãƒ¼ã‚¸
    const mergedFilters = { ...defaultFilters, ...filters };
    
    // ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ§‹ç¯‰
    const queryParams = new URLSearchParams();
    for (const [key, value] of Object.entries(mergedFilters)) {
      if (value !== 'all') {
        queryParams.append(key, value);
      }
    }
    
    // APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®URLæ§‹ç¯‰
    const apiUrl = `/myapp/index.cgi/api/teacher/students?${queryParams}`;
    
    console.log(`APIå‘¼ã³å‡ºã—: ${apiUrl}`);
    
    // APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿè¡Œ
    return fetch(apiUrl)
      .then(response => {
        if (!response.ok) {
          if (response.status === 404) {
            // APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚¨ãƒ©ãƒ¼
            throw new Error('APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚µãƒ¼ãƒãƒ¼è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
          }
          throw new Error('ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ' + response.status + 'ï¼‰');
        }
        return response.json();
      })
      .then(data => {
        if (data.success && data.students) {
          console.log('ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ:', data.students.length + 'ä»¶');
          
          // å„ç”Ÿå¾’ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢
          return data.students.map(student => {
            // å¿…è¦ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å­˜åœ¨ã‚’ç¢ºèª
            if (student.grade_level === undefined || student.grade_level === null) {
              console.warn(`å­¦å¹´ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ç”Ÿå¾’: ${student.id} ${student.name}`);
            }
            if (!student.school_type) {
              console.warn(`å­¦æ ¡ç¨®åˆ¥ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ç”Ÿå¾’: ${student.id} ${student.name}`);
            }
            
            return {
              ...student,
              // å‹å¤‰æ›ã‚’ç¢ºå®Ÿã«è¡Œã†
              grade_level: parseInt(student.grade_level || 0, 10) || 0,
              // å¿…é ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒç¢ºå®Ÿã«å­˜åœ¨ã™ã‚‹ã‚ˆã†ã«
              school_type: student.school_type || 'unset'
            };
          });
        } else {
          console.error('ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒä¸æ­£:', data);
          throw new Error('ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
        }
      });
  }
  
  // ç”Ÿå¾’ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
  function displayStudents(students) {
    const studentList = document.getElementById('student-list');
    if (!studentList) return;
    
    studentList.innerHTML = ''; // ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
    
    if (!students || students.length === 0) {
        studentList.innerHTML = '<div class="empty-message">ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
        return;
    }
    
    // ä»Šæ—¥ã®æ›œæ—¥ã‚’å–å¾—
    const today = new Date();
    const currentDayOfWeek = today.getDay(); // 0:æ—¥æ›œã€1:æœˆæ›œ...
    const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
    const currentDayName = dayNames[currentDayOfWeek];
    
    students.forEach(student => {
        const studentCard = document.createElement('div');
        studentCard.className = 'student-card';
        studentCard.dataset.id = student.id;
        studentCard.dataset.dayOfWeek = currentDayOfWeek;
        
        // å­¦å¹´è¡¨ç¤ºã®ç”Ÿæˆ
        let gradeDisplay = getGradeDisplay(student.grade_level, student.school_type);
        
        // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã«å¿œã˜ãŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
        let statusClass = 'status-offline';
        let statusText = 'æœªãƒ­ã‚°ã‚¤ãƒ³';
        
        if (student.hasLoggedInToday) {
            statusClass = 'status-online';
            statusText = 'ä»Šæ—¥ãƒ­ã‚°ã‚¤ãƒ³';
        } else if (student.lastLogin) {
            const daysSinceLogin = Math.floor((new Date() - new Date(student.lastLogin)) / (1000 * 60 * 60 * 24));
            if (daysSinceLogin < 3) {
                statusClass = 'status-today';
                statusText = `${daysSinceLogin}æ—¥å‰`;
            }
        }
        
        // å‡ºå¸­çŠ¶æ…‹ã®è¡¨ç¤º
        let attendanceMarker = '';
        if (student.attendanceToday === 'present') {
            attendanceMarker = `
                <div class="attendance-marker">
                    <span class="present-indicator"></span>å‡ºå¸­æ¸ˆã¿
                </div>
            `;
        } else if (student.attendanceToday === 'absent') {
            attendanceMarker = `
                <div class="attendance-marker">
                    <span class="absent-indicator"></span>æ¬ å¸­
                </div>
            `;
        }
        
        // æˆæ¥­æ—¥ãƒã‚§ãƒƒã‚¯ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
        const isClassDay = isScheduledClassDay(student, currentDayOfWeek);
        
        // æˆæ¥­æ—¥ã®å ´åˆã¯ã‚«ãƒ¼ãƒ‰ã«ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
        if (isClassDay) {
            studentCard.classList.add('class-day');
        }
        
        // æˆæ¥­æ—¥è¡¨ç¤ºã‚’è¿½åŠ 
        let classDayInfo = '';
        if (isClassDay) {
            classDayInfo = `<div class="class-day-info">æœ¬æ—¥(${currentDayName})ã¯æˆæ¥­æ—¥ã§ã™ âœ“</div>`;
        } else {
            classDayInfo = `<div class="class-day-info not-scheduled">æœ¬æ—¥(${currentDayName})ã¯æˆæ¥­æ—¥ã§ã¯ã‚ã‚Šã¾ã›ã‚“</div>`;
        }
        
        // ç”Ÿå¾’ã‚«ãƒ¼ãƒ‰ã®HTMLã‚’è¨­å®š
        studentCard.innerHTML = `
            <div class="student-header">
                <div>
                    <div class="student-name">${student.name}</div>
                    <div class="student-grade">${gradeDisplay}</div>
                    ${classDayInfo}
                </div>
            </div>
            ${attendanceMarker}
            <div class="student-status">
                <span>
                    <span class="status-indicator ${statusClass}"></span>
                    ${statusText}
                </span>
            </div>
            <div class="student-actions">
                <button class="student-action-btn attendance-btn" data-id="${student.id}">å‡ºå¸­ç¢ºèª</button>
                <button class="student-action-btn detail-btn student-login-btn" data-student-id="${student.id}">ç”Ÿå¾’ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³</button>
            </div>
        `;
        
        studentList.appendChild(studentCard);
    });
    
    // å‡ºå¸­ç¢ºèªãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
    setupAttendanceButtonListeners();
  }
  
  // ç”Ÿå¾’è©³ç´°ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
  function openStudentDetails(studentId) {
    // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¦æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
    fetch(`/myapp/index.cgi/teacher/student-access-token/${studentId}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.open(data.access_url, '_blank');
            } else {
                alert('ç”Ÿå¾’ã‚¢ã‚¯ã‚»ã‚¹ã®æº–å‚™ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + data.message);
            }
        })
        .catch(error => {
            console.error('ç”Ÿå¾’ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
        });
  }
  
  // å­¦å¹´è¡¨ç¤ºã‚’ç”Ÿæˆã™ã‚‹é–¢æ•° - å­¦æ ¡ã‚¿ã‚¤ãƒ—ã¨å­¦å¹´ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸè¡¨ç¤ºã‚’è¿”ã™
  function getGradeDisplay(gradeLevel, schoolType) {
    console.log(`getGradeDisplayå‘¼ã³å‡ºã—: gradeLevel=${gradeLevel}, schoolType=${schoolType}`);
    
    // å­¦æ ¡ç¨®åˆ¥ãŒæœªè¨­å®šã®å ´åˆ
    if (!schoolType || schoolType === 'unset' || schoolType === '') {
      return 'æœªè¨­å®š';
    }
    
    // å­¦å¹´ãŒæœªè¨­å®šã‹ç„¡åŠ¹ãªå ´åˆ
    if (gradeLevel === undefined || gradeLevel === null || gradeLevel === '' || isNaN(Number(gradeLevel))) {
      if (schoolType === 'elementary') return 'å°å­¦ç”Ÿ';
      if (schoolType === 'middle') return 'ä¸­å­¦ç”Ÿ';
      if (schoolType === 'high') return 'é«˜æ ¡ç”Ÿ';
      return 'æœªè¨­å®š';
    }
    
    // æ•°å€¤å‹ã«å¤‰æ›ã—ã¦å‡¦ç†
    const grade = Number(gradeLevel);
    
    // å­¦æ ¡ç¨®é¡ã«å¿œã˜ã¦é©åˆ‡ãªå­¦å¹´è¡¨ç¤ºã‚’è¿”ã™
    if (schoolType === 'elementary') {
      // å°å­¦ç”Ÿ: 1-6å¹´ç”Ÿ
      if (grade >= 1 && grade <= 6) {
        return `å°${grade}å¹´ç”Ÿ`;
      }
      return `å°å­¦ç”Ÿ(${grade})`;
    } else if (schoolType === 'middle') {
      // ä¸­å­¦ç”Ÿ: å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã¯7-9ã§ã¯ãªã1-3ã§æ ¼ç´ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„
      if (grade >= 7 && grade <= 9) {
        // 7-9ã®å ´åˆã¯ä¸­1-3ã«å¤‰æ›
        return `ä¸­${grade - 6}å¹´ç”Ÿ`;
      } else if (grade >= 1 && grade <= 3) {
        // 1-3ã®å ´åˆã¯ãã®ã¾ã¾ä¸­1-3ã¨ã—ã¦è¡¨ç¤º
        return `ä¸­${grade}å¹´ç”Ÿ`;
      } else {
        return `ä¸­å­¦ç”Ÿ(${grade})`;
      }
    } else if (schoolType === 'high') {
      // é«˜æ ¡ç”Ÿ: åŒæ§˜ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã¯1-3ã‹10-12ã‹ã‚’åˆ¤æ–­
      if (grade >= 10 && grade <= 12) {
        return `é«˜${grade - 9}å¹´ç”Ÿ`;
      } else if (grade >= 1 && grade <= 3) {
        return `é«˜${grade}å¹´ç”Ÿ`;
      } else {
        return `é«˜æ ¡ç”Ÿ(${grade})`;
      }
    }
    
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
    return `${grade}å¹´ç”Ÿ`;
  }
  
  // å‡ºå¸­ç¢ºèªãƒœã‚¿ãƒ³ã¨ç”Ÿå¾’ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šã™ã‚‹é–¢æ•°
  function setupAttendanceButtonListeners() {
    console.log('å‡ºå¸­ç¢ºèªãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šä¸­...');
    
    // å‡ºå¸­ç¢ºèªãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.querySelectorAll('.attendance-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const studentId = this.dataset.id;
            console.log(`å‡ºå¸­ç¢ºèªãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ: ç”Ÿå¾’ID = ${studentId}`);
            // å‡ºå¸­ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            showAttendanceModalForStudent(studentId);
        });
    });
    
    // ç”Ÿå¾’ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.querySelectorAll('.student-login-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const studentId = this.dataset.studentId;
            console.log(`ç”Ÿå¾’ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ: ç”Ÿå¾’ID = ${studentId}`);
            // æ–°ã—ã„ã‚¿ãƒ–ã§ç”Ÿå¾’ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³
            window.open(`/myapp/index.cgi/teacher/login-as-student/${studentId}`, '_blank');
        });
    });
    
    console.log(`è¨­å®šå®Œäº†: å‡ºå¸­ç¢ºèªãƒœã‚¿ãƒ³ ${document.querySelectorAll('.attendance-btn').length}å€‹, ç”Ÿå¾’ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ ${document.querySelectorAll('.student-login-btn').length}å€‹`);
  }
  
  // å€‹åˆ¥ç”Ÿå¾’ã®å‡ºå¸­ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
  function showAttendanceModalForStudent(studentId) {
    console.log(`å€‹åˆ¥ç”Ÿå¾’ã®å‡ºå¸­ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º: ç”Ÿå¾’ID = ${studentId}`);
    // å˜ä¸€ç”Ÿå¾’ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    fetch(`/myapp/index.cgi/api/teacher/students?student_id=${studentId}`)
      .then(response => response.json())
      .then(data => {
        if (data.success && data.students && data.students.length > 0) {
          const student = data.students[0];
          console.log('å–å¾—ã—ãŸç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿:', student);
          showAttendanceModal([student]);
        } else {
          console.error('ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', data);
          alert('ç”Ÿå¾’æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      })
      .catch(error => {
        console.error('ç”Ÿå¾’æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        alert(error.message || 'ç”Ÿå¾’æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
      });
  }
  
  // å‡ºå¸­ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
  function showAttendanceModal(students) {
    console.log('å‡ºå¸­ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º:', students);
    const modal = document.getElementById('attendance-modal');
    const attendanceList = document.getElementById('attendance-list');
    const dateInput = document.getElementById('attendance-date-input');
    
    if (!modal || !attendanceList || !dateInput) {
        console.error('ãƒ¢ãƒ¼ãƒ€ãƒ«è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
    }
    
    // æ—¥ä»˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ä»Šæ—¥ã®æ—¥ä»˜ã‚’ã‚»ãƒƒãƒˆ
    const today = new Date();
    const formattedDate = today.toISOString().split('T')[0];
    dateInput.value = formattedDate;
    
    // ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
    attendanceList.innerHTML = '';
    
    if (!students || students.length === 0) {
        attendanceList.innerHTML = '<div class="empty-message">å¯¾è±¡ã¨ãªã‚‹ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
        modal.style.display = 'block';
        return;
    }
    
    // åˆæœŸè¡¨ç¤ºæ™‚ã®æ›œæ—¥
    const dayOfWeek = today.getDay(); // 0ã¯æ—¥æ›œæ—¥
    
    // å‡ºå¸­ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
    displayAttendanceList(students, dayOfWeek, today);
    
    // æ—¥ä»˜é¸æŠæ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ  - é¸æŠã—ãŸæ—¥ä»˜ã®æ›œæ—¥ã‚’ä½¿ç”¨
    dateInput.addEventListener('change', function() {
        const selectedDate = new Date(this.value);
        const selectedDayOfWeek = selectedDate.getDay(); // 0=æ—¥æ›œã€1=æœˆæ›œ...
        console.log(`é¸æŠã•ã‚ŒãŸæ—¥ä»˜: ${this.value}, æ›œæ—¥: ${selectedDayOfWeek}`);
        
        // é¸æŠã—ãŸæ—¥ä»˜ã®æ›œæ—¥ã§å‡ºå¸­ãƒªã‚¹ãƒˆã‚’æ›´æ–°
        displayAttendanceList(students, selectedDayOfWeek, selectedDate);
    });
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
    modal.style.display = 'block';
  }
  
  // å‡ºå¸­ãƒªã‚¹ãƒˆè¡¨ç¤ºé–¢æ•° - æ›œæ—¥ã‚’å¼•æ•°ã«è¿½åŠ 
  function displayAttendanceList(students, dayOfWeek, date) {
    const attendanceList = document.getElementById('attendance-list');
    attendanceList.innerHTML = '';
    
    if (!students || students.length === 0) {
        attendanceList.innerHTML = '<div class="empty-message">å¯¾è±¡ã¨ãªã‚‹ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
        return;
    }
    
    // æ›œæ—¥åã®é…åˆ—
    const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
    const formattedDayName = dayNames[dayOfWeek];
    
    // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ (YYYY-MM-DD)
    const formattedDate = date.toISOString().split('T')[0];
    
    students.forEach(student => {
        const row = document.createElement('div');
        row.className = 'attendance-row';
        row.dataset.id = student.id;
        
        // å­¦å¹´è¡¨ç¤ºã®ç”Ÿæˆ
        let gradeDisplay = getGradeDisplay(student.grade_level, student.school_type);
        
        // æˆç¸¾å‘ä¸Šæƒ…å ±ã‚’è¡¨ç¤º
        let improvementInfo = '';
        
        if (student.improvement > 0) {
          improvementInfo = `
            <div class="improvement-info">
              <span class="improvement-label">æˆç¸¾å‘ä¸Š:</span>
              <span class="improvement-value positive">${student.improvement}ç‚¹</span>
            </div>
          `;
        } else if (student.improvement < 0) {
          improvementInfo = `
            <div class="improvement-info">
              <span class="improvement-label">æˆç¸¾ä½ä¸‹:</span>
              <span class="improvement-value negative">${student.improvement}ç‚¹</span>
            </div>
          `;
        }
        
        // æˆæ¥­æ—¥ãƒã‚§ãƒƒã‚¯ - é¸æŠã•ã‚ŒãŸæ›œæ—¥ã‚’ä½¿ç”¨
        const isClassDay = isScheduledClassDay(student, dayOfWeek);
        
        // æˆæ¥­æ—¥æƒ…å ±ã‚’è¡Œã«ä¿å­˜ï¼ˆå‡ºå¸­çŠ¶æ…‹é€ä¿¡æ™‚ã«ä½¿ç”¨ï¼‰
        row.dataset.isClassDay = isClassDay ? 'true' : 'false';
        
        // æˆæ¥­æ—¥è¡¨ç¤ºã‚’è¿½åŠ 
        let classDayInfo = '';
        if (isClassDay) {
            classDayInfo = `<div class="class-day-info">ã“ã®æ—¥(${formattedDayName})ã¯æˆæ¥­æ—¥ã§ã™ âœ“</div>`;
        } else {
            classDayInfo = `<div class="class-day-info not-scheduled">ã“ã®æ—¥(${formattedDayName})ã¯æˆæ¥­æ—¥ã§ã¯ã‚ã‚Šã¾ã›ã‚“</div>`;
        }
        
        row.innerHTML = `
            <div class="attendance-student-name">
                ${student.name} (${gradeDisplay})
                ${classDayInfo}
            </div>
            <div class="attendance-options">
                <label class="attendance-option">
                    <input type="radio" name="attendance-${student.id}" value="present" ${student.attendanceToday === 'present' ? 'checked' : ''}>
                    å‡ºå¸­ ${isClassDay ? '<span class="point-hint">(+10ãƒã‚¤ãƒ³ãƒˆ)</span>' : ''}
                </label>
                <label class="attendance-option">
                    <input type="radio" name="attendance-${student.id}" value="absent" ${student.attendanceToday === 'absent' ? 'checked' : ''}>
                    æ¬ å¸­
                </label>
                <label class="attendance-option">
                    <input type="radio" name="attendance-${student.id}" value="late" ${student.attendanceToday === 'late' ? 'checked' : ''}>
                    é…åˆ»
                </label>
                <label class="attendance-option">
                    <input type="radio" name="attendance-${student.id}" value="none" ${!student.attendanceToday ? 'checked' : ''}>
                    æœªè¨­å®š
                </label>
            </div>
        `;
        
        attendanceList.appendChild(row);
    });
  }
  
  // æˆæ¥­æ—¥ãƒã‚§ãƒƒã‚¯é–¢æ•°ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
  function isScheduledClassDay(student, dayOfWeek) {
    // ç”Ÿå¾’ã®é€šå¡¾æ›œæ—¥æƒ…å ±ãŒãªã„å ´åˆã¯å¸¸ã«falseã‚’è¿”ã™
    if (!student.attendance_days) return false;
    
    // attendance_daysã¯ "0,2,5" ã®ã‚ˆã†ãªæ–‡å­—åˆ—
    const attendanceDays = student.attendance_days.split(',').map(day => parseInt(day, 10));
    
    // æŒ‡å®šã•ã‚ŒãŸæ›œæ—¥ãŒé€šå¡¾æ›œæ—¥ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
    return attendanceDays.includes(dayOfWeek);
  }
  
  // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å–å¾—é–¢æ•° - class_schedule_masterãƒ†ãƒ¼ãƒ–ãƒ«ã¨é€£æº
  async function getClassSchedule() {
    try {
      // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚Œã°ä½¿ç”¨
      const cached = localStorage.getItem('class_schedule');
      if (cached) {
        return JSON.parse(cached);
      }
      
      // APIã‹ã‚‰å–å¾—
      const response = await fetch('/myapp/index.cgi/api/teacher/class-schedule');
      if (response.ok) {
        const data = await response.json();
        if (data.success && data.schedule) {
          localStorage.setItem('class_schedule', JSON.stringify(data.schedule));
          return data.schedule;
        }
      }
      
      throw new Error('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
    } catch (e) {
      console.error('æˆæ¥­æ—¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å–å¾—ã‚¨ãƒ©ãƒ¼:', e);
      
      // APIãŒãªã„å ´åˆã‚„åˆå›ã®å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’è¿”ã™
      // å®Ÿéš›ã®APIãŒæ•´å‚™ã•ã‚Œã‚‹ã¾ã§ã®ãƒ†ã‚¹ãƒˆç”¨
      const defaultSchedule = [];
      
      // å°å­¦ç”Ÿï¼ˆå°1-å°6ï¼‰ï¼šæœˆãƒ»æ°´æ›œæˆæ¥­
      for (let grade = 1; grade <= 6; grade++) {
        defaultSchedule.push({ grade_level: grade, school_type: 'elementary', day_of_week: 1 }); // æœˆæ›œæ—¥
        defaultSchedule.push({ grade_level: grade, school_type: 'elementary', day_of_week: 3 }); // æ°´æ›œæ—¥
      }
      
      // ä¸­å­¦ç”Ÿï¼ˆä¸­1-ä¸­3ï¼‰ï¼šç«ãƒ»é‡‘æ›œæˆæ¥­
      for (let grade = 1; grade <= 3; grade++) {
        defaultSchedule.push({ grade_level: grade, school_type: 'middle', day_of_week: 2 }); // ç«æ›œæ—¥
        defaultSchedule.push({ grade_level: grade, school_type: 'middle', day_of_week: 5 }); // é‡‘æ›œæ—¥
      }
      
      // é«˜æ ¡ç”Ÿï¼ˆé«˜1-é«˜3ï¼‰ï¼šæœ¨ãƒ»åœŸæ›œæˆæ¥­
      for (let grade = 1; grade <= 3; grade++) {
        defaultSchedule.push({ grade_level: grade, school_type: 'high', day_of_week: 4 }); // æœ¨æ›œæ—¥
        defaultSchedule.push({ grade_level: grade, school_type: 'high', day_of_week: 6 }); // åœŸæ›œæ—¥
      }
      
      // ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
      localStorage.setItem('class_schedule', JSON.stringify(defaultSchedule));
      return defaultSchedule;
    }
  }
  
  // å­¦å¹´åˆ¥æ›œæ—¥è¨­å®šã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
  function loadGradeSchedule() {
    getClassSchedule().then(schedule => {
      // æ—¢å­˜ã®è¨­å®šã‚’ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã«åæ˜ 
      schedule.forEach(item => {
        // å­¦å¹´ã¨å­¦æ ¡ç¨®åˆ¥ã‹ã‚‰ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¡Œã‚’ç‰¹å®š
        let gradeKey;
        
        if (item.school_type === 'elementary') {
          gradeKey = `elementary-${item.grade_level}`;
        } else if (item.school_type === 'middle') {
          // ä¸­å­¦ç”Ÿ: 1-3ã¾ãŸã¯7-9ã«å¯¾å¿œ
          const grade = item.grade_level;
          if (grade >= 7 && grade <= 9) {
            gradeKey = `middle-${grade - 6}`;
          } else {
            gradeKey = `middle-${grade}`;
          }
        } else if (item.school_type === 'high') {
          // é«˜æ ¡ç”Ÿ: 1-3ã¾ãŸã¯10-12ã«å¯¾å¿œ
          const grade = item.grade_level;
          if (grade >= 10 && grade <= 12) {
            gradeKey = `high-${grade - 9}`;
          } else {
            gradeKey = `high-${grade}`;
          }
        } else {
          return; // ä¸æ˜ãªå­¦æ ¡ç¨®åˆ¥ã¯ã‚¹ã‚­ãƒƒãƒ—
        }
        
        const row = document.querySelector(`tr[data-grade="${gradeKey}"]`);
        if (!row) return;
        
        // æ›œæ—¥ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹
        const checkbox = row.querySelector(`input[data-day="${item.day_of_week}"]`);
        if (checkbox) checkbox.checked = true;
      });
    }).catch(error => {
      console.error('æ›œæ—¥è¨­å®šã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
      // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’é©ç”¨
      setDefaultSchedule();
    });
  }
  
  // ã‚µãƒ³ãƒ—ãƒ«ã®æ›œæ—¥è¨­å®šã‚’é©ç”¨
  function setDefaultSchedule() {
    // å°å­¦ç”Ÿã¯æœˆãƒ»æ°´æ›œæ—¥
    for (let i = 1; i <= 6; i++) {
      const row = document.querySelector(`tr[data-grade="elementary-${i}"]`);
      if (row) {
        row.querySelector('input[data-day="1"]').checked = true; // æœˆæ›œæ—¥
        row.querySelector('input[data-day="3"]').checked = true; // æ°´æ›œæ—¥
      }
    }
    
    // ä¸­å­¦ç”Ÿã¯ç«ãƒ»é‡‘æ›œæ—¥
    for (let i = 1; i <= 3; i++) {
      const row = document.querySelector(`tr[data-grade="middle-${i}"]`);
      if (row) {
        row.querySelector('input[data-day="2"]').checked = true; // ç«æ›œæ—¥
        row.querySelector('input[data-day="5"]').checked = true; // é‡‘æ›œæ—¥
      }
    }
    
    // é«˜æ ¡ç”Ÿã¯æœ¨ãƒ»åœŸæ›œæ—¥
    for (let i = 1; i <= 3; i++) {
      const row = document.querySelector(`tr[data-grade="high-${i}"]`);
      if (row) {
        row.querySelector('input[data-day="4"]').checked = true; // æœ¨æ›œæ—¥
        row.querySelector('input[data-day="6"]').checked = true; // åœŸæ›œæ—¥
      }
    }
  }
  
  // å­¦å¹´åˆ¥æ›œæ—¥è¨­å®šã‚’ä¿å­˜ã™ã‚‹é–¢æ•° - class_schedule_masterãƒ†ãƒ¼ãƒ–ãƒ«ã¨é€£æº
  function saveGradeSchedule() {
    const scheduleData = [];
    
    // å„å­¦å¹´ã®è¨­å®šã‚’åé›†
    document.querySelectorAll('#grade-schedule-tbody tr').forEach(row => {
      const gradeKey = row.dataset.grade;
      if (!gradeKey) return;
      
      // å­¦æ ¡ç¨®åˆ¥ã¨å­¦å¹´ãƒ¬ãƒ™ãƒ«ã‚’æŠ½å‡º
      let schoolType, gradeLevel;
      if (gradeKey.startsWith('elementary-')) {
        schoolType = 'elementary';
        gradeLevel = parseInt(gradeKey.split('-')[1]);
      } else if (gradeKey.startsWith('middle-')) {
        schoolType = 'middle';
        gradeLevel = parseInt(gradeKey.split('-')[1]);
      } else if (gradeKey.startsWith('high-')) {
        schoolType = 'high';
        gradeLevel = parseInt(gradeKey.split('-')[1]);
      } else {
        return;
      }
      
      // æ›œæ—¥è¨­å®šã‚’åé›†
      row.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
        const dayOfWeek = parseInt(checkbox.dataset.day);
        
        scheduleData.push({
          grade_level: gradeLevel,
          school_type: schoolType,
          day_of_week: dayOfWeek
        });
      });
    });
    
    // APIã«é€ä¿¡
    fetch('/myapp/index.cgi/api/teacher/class-schedule', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ schedule: scheduleData })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('å­¦å¹´åˆ¥æ›œæ—¥è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
        document.getElementById('grade-schedule-modal').style.display = 'none';
        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
        localStorage.setItem('class_schedule', JSON.stringify(scheduleData));
      } else {
        alert('è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + data.message);
      }
    })
    .catch(error => {
      console.error('Error saving grade schedule:', error);
      // ãƒ†ã‚¹ãƒˆç’°å¢ƒç”¨ã«ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
      localStorage.setItem('class_schedule', JSON.stringify(scheduleData));
      alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼‰');
      document.getElementById('grade-schedule-modal').style.display = 'none';
    });
  }
  
  // å‡ºå¸­æƒ…å ±ã‚’ä¿å­˜ã™ã‚‹é–¢æ•°
  function saveAttendanceRecords(attendanceData) {
    console.log('å‡ºå¸­æƒ…å ±ã‚’ä¿å­˜ã—ã¾ã™:', attendanceData);
    return fetch('/myapp/index.cgi/api/teacher/attendance', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ attendance_records: attendanceData })
    })
    .then(response => response.json())
    .then(data => {
      console.log('å‡ºå¸­æƒ…å ±ä¿å­˜çµæœ:', data);
      if (data.success) {
        return data;
      } else {
        throw new Error(data.message || 'å‡ºå¸­è¨˜éŒ²ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    });
  }
  
  // å­¦å¹´ã¨æ›œæ—¥ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ãŸç”Ÿå¾’ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
  function updateStudentDisplay(grade, day) {
    // API ãƒªã‚¯ã‚¨ã‚¹ãƒˆç”¨ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’æ§‹ç¯‰
    const filters = {};
    
    // å­¦å¹´ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å‡¦ç†
    if (grade && grade !== 'all') {
      // ç‰¹æ®Šãªå­¦å¹´å½¢å¼ã®å‡¦ç†ï¼ˆä¾‹ï¼šelementary-1 â†’ elementary + 1ï¼‰
      if (grade.includes('-')) {
        const [schoolType, gradeNum] = grade.split('-');
        filters.school_type = schoolType;
        filters.grade_level = gradeNum;
      } else {
        filters.grade = grade;
      }
    }
    
    // æ›œæ—¥ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å‡¦ç†
    if (day && day !== 'all') {
      filters.day = day;
    }
    
    console.log('ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨­å®š:', filters);  // ãƒ‡ãƒãƒƒã‚°ç”¨
    
    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
    const studentList = document.getElementById('student-list');
    if (studentList) {
      studentList.innerHTML = '<div class="loading-message">ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
    }
    
    // ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿å–å¾—
    fetchStudents(filters)
      .then(students => {
        console.log(`${grade}/${day}ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã§ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—: ${students.length}ä»¶`, students);
        displayStudents(students);
      })
      .catch(error => {
        console.error('ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        if (studentList) {
          studentList.innerHTML = `
            <div class="empty-message error-message">
              <p><strong>ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:</strong> ${error.message}</p>
              <p>ä»¥ä¸‹ã‚’ã”ç¢ºèªãã ã•ã„:</p>
              <ul>
                <li>ã‚µãƒ¼ãƒãƒ¼ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã‹</li>
                <li>APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹</li>
                <li>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã«å•é¡ŒãŒãªã„ã‹</li>
              </ul>
            </div>
          `;
        }
      });
  }

  // æˆç¸¾å‘ä¸Šãƒ•ã‚£ãƒ«ã‚¿ã®ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
  function setupImprovementFilter() {
    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ‘ãƒãƒ«ã®åˆ‡ã‚Šæ›¿ãˆå‡¦ç†
    document.querySelectorAll('.filter-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆ
        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        
        // ãƒ‘ãƒãƒ«ã®åˆ‡ã‚Šæ›¿ãˆ
        const filterType = this.dataset.filter;
        document.querySelectorAll('.filter-panel').forEach(panel => panel.classList.remove('active'));
        document.getElementById(`${filterType}-filter`).classList.add('active');
      });
    });
    
    // å°å­¦ç”Ÿãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨ãƒœã‚¿ãƒ³
    document.getElementById('elementary-filter-btn').addEventListener('click', function() {
      const startMonth = document.getElementById('elementary-start-month').value;
      const endMonth = document.getElementById('elementary-end-month').value;
      const subject = document.getElementById('elementary-subject').value;
      const minImprovement = document.getElementById('elementary-min-improvement').value;
      
      fetchStudentsWithImprovedGrades('elementary', {
        start_month: startMonth,
        end_month: endMonth,
        subject: subject,
        min_improvement: minImprovement
      });
    });
    
    // ä¸­å­¦ç”Ÿãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨ãƒœã‚¿ãƒ³
    document.getElementById('middle-filter-btn').addEventListener('click', function() {
      const startYear = document.getElementById('middle-start-year').value;
      const startTerm = document.getElementById('middle-start-term').value;
      const endYear = document.getElementById('middle-end-year').value;
      const endTerm = document.getElementById('middle-end-term').value;
      const subject = document.getElementById('middle-subject').value;
      
      fetchStudentsWithImprovedGrades('middle', {
        start_year: startYear,
        start_term: startTerm,
        end_year: endYear,
        end_term: endTerm,
        subject: subject
      });
    });
  }

  // æˆç¸¾å‘ä¸Šç”Ÿå¾’ã‚’å–å¾—ã™ã‚‹é–¢æ•°
  function fetchStudentsWithImprovedGrades(schoolType, filters) {
    const queryParams = new URLSearchParams();
    queryParams.append('type', schoolType);
    
    for (const [key, value] of Object.entries(filters)) {
      queryParams.append(key, value);
    }
    
    // APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®URLæ§‹ç¯‰
    const apiUrl = `/myapp/index.cgi/api/teacher/improved-students?${queryParams}`;
    
    console.log(`æˆç¸¾å‘ä¸Šç”Ÿå¾’APIå‘¼ã³å‡ºã—: ${apiUrl}`);
    
    // ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã®è¡¨ç¤º
    const studentList = document.getElementById('student-list');
    studentList.innerHTML = '<div class="loading-message">æˆç¸¾å‘ä¸Šç”Ÿå¾’ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...</div>';
    
    // fetch APIã§ãƒ‡ãƒ¼ã‚¿å–å¾—
    fetch(apiUrl)
      .then(response => {
        if (!response.ok) {
          throw new Error('ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
        return response.json();
      })
      .then(data => {
        if (data.success && data.students) {
          console.log('æˆç¸¾å‘ä¸Šç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ:', data.students.length + 'ä»¶');
          
          // ç”Ÿå¾’ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
          displayImprovedStudents(data.students, schoolType);
        } else {
          console.error('ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒä¸æ­£:', data);
          studentList.innerHTML = '<div class="empty-message">ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</div>';
        }
      })
      .catch(error => {
        console.error('ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        
        // APIãŒãªã„å ´åˆã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        studentList.innerHTML = `
          <div class="empty-message error-message">
            <p><strong>ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:</strong> ${error.message}</p>
            <p>æˆç¸¾å‘ä¸Šãƒ‡ãƒ¼ã‚¿ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ç®¡ç†è€…ã«ã”é€£çµ¡ãã ã•ã„ã€‚</p>
          </div>
        `;
      });
  }

  // æˆç¸¾å‘ä¸Šç”Ÿå¾’ã®è¡¨ç¤º
  function displayImprovedStudents(students, schoolType) {
    const studentList = document.getElementById('student-list');
    studentList.innerHTML = ''; // ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
    
    if (!students || students.length === 0) {
      studentList.innerHTML = '<div class="empty-message">æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ç”Ÿå¾’ã¯ã„ã¾ã›ã‚“ã€‚</div>';
      return;
    }
    
    students.forEach(student => {
      const studentCard = document.createElement('div');
      studentCard.className = 'student-card improvement-card';
      studentCard.dataset.id = student.id;
      
      // å­¦å¹´è¡¨ç¤ºã®ç”Ÿæˆ
      let gradeDisplay = getGradeDisplay(student.grade_level, student.school_type);
      
      // æˆç¸¾å‘ä¸Šæƒ…å ±ã‚’è¡¨ç¤º
      let improvementInfo = '';
      
      if (schoolType === 'elementary') {
        improvementInfo = `
          <div class="improvement-info">
            <div class="improvement-subject">${student.subject_name}</div>
            <div class="improvement-scores">
              ${student.previous_month}æœˆ: ${student.previous_score}ç‚¹ â†’ ${student.current_month}æœˆ: ${student.current_score}ç‚¹
            </div>
            <div class="improvement-diff ${student.improvement > 0 ? 'positive' : 'negative'}">
              ${student.improvement > 0 ? '+' : ''}${student.improvement}ç‚¹
            </div>
          </div>
        `;
      } else {
        improvementInfo = `
          <div class="improvement-info">
            <div class="improvement-subject">${student.subject_name}</div>
            <div class="improvement-scores">
              ${student.previous_year}å¹´${student.previous_term}å­¦æœŸ: ${student.previous_point} â†’ 
              ${student.current_year}å¹´${student.current_term}å­¦æœŸ: ${student.current_point}
            </div>
            <div class="improvement-diff ${student.improvement > 0 ? 'positive' : 'negative'}">
              ${student.improvement > 0 ? '+' : ''}${student.improvement}
            </div>
          </div>
        `;
      }
      
      // ä»˜ä¸ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—
      let potentialPoints = 0;
      let improvementLevel = '';
      
      if (schoolType === 'elementary') {
        if (student.improvement >= 15) {
          potentialPoints = 50;
          improvementLevel = 'å¤§';
        } else if (student.improvement >= 10) {
          potentialPoints = 30;
          improvementLevel = 'ä¸­';
        } else if (student.improvement >= 5) {
          potentialPoints = 20;
          improvementLevel = 'å°';
        }
      } else {
        if (student.improvement >= 2) {
          potentialPoints = 50;
          improvementLevel = 'å¤§';
        } else if (student.improvement >= 1) {
          potentialPoints = 30;
          improvementLevel = 'ä¸­';
        }
      }
      
      // ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ãƒœã‚¿ãƒ³ï¼ˆ5ç‚¹ä»¥ä¸Šã¾ãŸã¯å†…ç”³1ä»¥ä¸Šã®å ´åˆã®ã¿è¡¨ç¤ºï¼‰
      let awardButton = '';
      if (potentialPoints > 0) {
        awardButton = `
          <button class="award-points-btn" 
            data-student-id="${student.id}" 
            data-points="${potentialPoints}" 
            data-improvement="${student.improvement}"
            data-level="${improvementLevel}"
            data-subject="${student.subject_id}"
            data-subject-name="${student.subject_name}"
            data-type="${schoolType}">
            ${potentialPoints}ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ (${improvementLevel}å¹…å‘ä¸Š)
          </button>
        `;
      }
      
      // ç”Ÿå¾’ã‚«ãƒ¼ãƒ‰ã®HTMLã‚’è¨­å®š
      studentCard.innerHTML = `
        <div class="student-header">
          <div>
            <div class="student-name">${student.name}</div>
            <div class="student-grade">${gradeDisplay}</div>
          </div>
          <div class="improvement-level improvement-level-${improvementLevel}">
            ${improvementLevel ? improvementLevel + 'å¹…å‘ä¸Š' : ''}
          </div>
        </div>
        ${improvementInfo}
        <div class="student-actions">
          ${awardButton}
          <button class="student-action-btn detail-btn student-login-btn" data-student-id="${student.id}">ç”Ÿå¾’ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³</button>
        </div>
      `;
      
      studentList.appendChild(studentCard);
    });
    
    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
    setupAttendanceButtonListeners();
    
    // ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.querySelectorAll('.award-points-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const studentId = this.dataset.studentId;
        const points = this.dataset.points;
        const improvement = this.dataset.improvement;
        const level = this.dataset.level;
        const subject = this.dataset.subject;
        const subjectName = this.dataset.subjectName;
        const type = this.dataset.type;
        
        console.log(`ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ: ç”Ÿå¾’ID = ${studentId}, ãƒã‚¤ãƒ³ãƒˆ = ${points}, å‘ä¸Šãƒ¬ãƒ™ãƒ« = ${level}`);
        
        // ãƒã‚¤ãƒ³ãƒˆä»˜ä¸APIå‘¼ã³å‡ºã—
        awardImprovementPoints(studentId, points, type, improvement, level, subject, subjectName, this);
      });
    });
    
    // ç”Ÿå¾’ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚‚è¨­å®š
    setupAttendanceButtonListeners();
  }
  
  // ãƒã‚¤ãƒ³ãƒˆä»˜ä¸APIå‘¼ã³å‡ºã—
  function awardImprovementPoints(studentId, points, type, improvement, level, subject, subjectName, button) {
    // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
    button.disabled = true;
    button.textContent = 'å‡¦ç†ä¸­...';
    
    // ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã®æ±ºå®š
    let eventType;
    if (type === 'elementary') {
      eventType = `grade_improvement_${level.toLowerCase()}`;
    } else {
      eventType = `internal_point_improvement_${level.toLowerCase()}`;
    }
    
    // ã‚³ãƒ¡ãƒ³ãƒˆã®ä½œæˆ
    let comment;
    if (type === 'elementary') {
      comment = `æˆç¸¾å‘ä¸Šãƒœãƒ¼ãƒŠã‚¹ï¼ˆ${level}ï¼‰: ${subjectName}ãŒ${improvement}ç‚¹å‘ä¸Š`;
    } else {
      comment = `å†…ç”³ç‚¹å‘ä¸Šãƒœãƒ¼ãƒŠã‚¹ï¼ˆ${level}ï¼‰: ${subjectName}ãŒ${improvement}ãƒã‚¤ãƒ³ãƒˆå‘ä¸Š`;
    }
    
    // APIãƒ‡ãƒ¼ã‚¿
    const apiData = {
      student_id: studentId,
      points: points,
      event_type: eventType,
      comment: comment,
      subject_id: subject
    };
    
    // ãƒã‚¤ãƒ³ãƒˆä»˜ä¸APIã‚’å‘¼ã³å‡ºã™
    fetch('/myapp/index.cgi/api/teacher/award-improvement-points', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(apiData)
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        alert(`${points}ãƒã‚¤ãƒ³ãƒˆã‚’ä»˜ä¸ã—ã¾ã—ãŸï¼`);
        
        // ãƒœã‚¿ãƒ³ã‚’å¤‰æ›´ï¼ˆç„¡åŠ¹åŒ–ã—ãŸã¾ã¾ï¼‰
        button.textContent = 'ãƒã‚¤ãƒ³ãƒˆä»˜ä¸æ¸ˆã¿';
        button.style.backgroundColor = '#cccccc';
      } else {
        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        alert(`ã‚¨ãƒ©ãƒ¼: ${data.message}`);
        
        // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
        button.disabled = false;
        button.textContent = `${points}ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ (${level}å¹…å‘ä¸Š)`;
      }
    })
    .catch(error => {
      console.error('ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ã‚¨ãƒ©ãƒ¼:', error);
      alert(`ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
      
      // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
      button.disabled = false;
      button.textContent = `${points}ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ (${level}å¹…å‘ä¸Š)`;
    });
  }
  
  // ç”Ÿå¾’æ¤œç´¢æ©Ÿèƒ½
  function setupStudentSearch() {
    const searchInput = document.getElementById('student-search');
    if (!searchInput) return;
    
    searchInput.addEventListener('input', function() {
      const query = this.value.toLowerCase();
      console.log("æ¤œç´¢ã‚¯ã‚¨ãƒª:", query);
      
      // ç”Ÿå¾’ã‚«ãƒ¼ãƒ‰ã‚’å…¨ã¦å–å¾—
      const studentCards = document.querySelectorAll('.student-card');
      
      studentCards.forEach(card => {
        const name = card.querySelector('.student-name').textContent.toLowerCase();
        const grade = card.querySelector('.student-grade').textContent.toLowerCase();
        
        // å­¦å¹´ã®ç°¡æ˜“è¡¨è¨˜ã‚‚è€ƒæ…®ï¼ˆä¾‹ï¼š"å°3"ã§"å°3å¹´ç”Ÿ"ã‚‚æ¤œç´¢ã§ãã‚‹ã‚ˆã†ã«ï¼‰
        let isMatch = name.includes(query) || grade.includes(query);
        
        // å­¦å¹´ã®ç‰¹åˆ¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œç´¢
        const schoolGradePatterns = [
          // å°å­¦ç”Ÿãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå°1ï½å°6ï¼‰
          { pattern: /å°(\d)/, display: "å°$1å¹´ç”Ÿ" },
          // ä¸­å­¦ç”Ÿãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆä¸­1ï½ä¸­3ï¼‰
          { pattern: /ä¸­(\d)/, display: "ä¸­$1å¹´ç”Ÿ" },
          // é«˜æ ¡ç”Ÿãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆé«˜1ï½é«˜3ï¼‰
          { pattern: /é«˜(\d)/, display: "é«˜$1å¹´ç”Ÿ" }
        ];
        
        // ç‰¹åˆ¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œç´¢
        schoolGradePatterns.forEach(pattern => {
          const match = query.match(pattern.pattern);
          if (match) {
            const expectedGrade = pattern.display.replace('$1', match[1]);
            console.log(`æ¤œç´¢ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º: ${query} â†’ ${expectedGrade}`);
            if (grade.includes(expectedGrade)) {
              isMatch = true;
            }
          }
        });
        
        // æ¤œç´¢çµæœã«åŸºã¥ã„ã¦è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
        if (isMatch) {
          card.style.display = '';
        } else {
          card.style.display = 'none';
        }
      });
      
      // è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ç”Ÿå¾’ã‚«ãƒ¼ãƒ‰ãŒãªã„å ´åˆã€ã€Œæ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
      const visibleCards = Array.from(document.querySelectorAll('.student-card')).filter(card => card.style.display !== 'none').length;
      const studentList = document.getElementById('student-list');
      const noResultsMessage = studentList.querySelector('.no-results-message');
      
      if (visibleCards === 0 && query) {
        if (!noResultsMessage) {
          const message = document.createElement('div');
          message.className = 'empty-message no-results-message';
          message.textContent = `"${query}" ã«ä¸€è‡´ã™ã‚‹ç”Ÿå¾’ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`;
          studentList.appendChild(message);
        }
      } else if (noResultsMessage) {
        noResultsMessage.remove();
      }
    });
  }
  
  // å­¦å¹´ã‚¿ãƒ–ã¨æ›œæ—¥ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆå‡¦ç†ã‚’è¨­å®š
  function setupTabs() {
    // å­¦å¹´ã‚¿ãƒ–å‡¦ç†
    const gradeTabs = document.querySelectorAll('.grade-tab');
    gradeTabs.forEach(tab => {
      tab.addEventListener('click', function() {
        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆ
        gradeTabs.forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        
        // é¸æŠã•ã‚ŒãŸå­¦å¹´ã®å–å¾—
        const grade = this.dataset.grade;
        console.log(`å­¦å¹´ã‚¿ãƒ–é¸æŠ: ${grade}`);
        
        // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹æ›œæ—¥ã‚¿ãƒ–ã‚’å–å¾—
        const activeDay = document.querySelector('.day-tab.active');
        const day = activeDay ? activeDay.dataset.day : 'all';
        
        // å­¦å¹´ã¨æ›œæ—¥ã®ä¸¡æ–¹ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        updateStudentDisplay(grade, day);
      });
    });
    
    // æ›œæ—¥ã‚¿ãƒ–å‡¦ç†
    const dayTabs = document.querySelectorAll('.day-tab');
    dayTabs.forEach(tab => {
      tab.addEventListener('click', function() {
        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆ
        dayTabs.forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        
        // é¸æŠã•ã‚ŒãŸæ›œæ—¥ã®å–å¾—
        const day = this.dataset.day;
        console.log(`æ›œæ—¥ã‚¿ãƒ–é¸æŠ: ${day}`);
        
        // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹å­¦å¹´ã‚¿ãƒ–ã‚’å–å¾—
        const activeGrade = document.querySelector('.grade-tab.active');
        const grade = activeGrade ? activeGrade.dataset.grade : 'all';
        
        // å­¦å¹´ã¨æ›œæ—¥ã®ä¸¡æ–¹ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        updateStudentDisplay(grade, day);
      });
    });
  }
  
  // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®å‡¦ç†
  document.addEventListener('DOMContentLoaded', function() {
    // ä»Šæ—¥ã®æ›œæ—¥ã‚’åæ˜ 
    const today = new Date();
    const currentDayOfWeek = today.getDay(); // 0:æ—¥æ›œã€1:æœˆæ›œ...
    
    // æœ¬æ—¥ã®æ›œæ—¥ã‚¿ãƒ–ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
    const todayTab = document.querySelector(`.day-tab[data-day="${currentDayOfWeek}"]`);
    if (todayTab) {
        todayTab.classList.add('today');
    }
    
    // åˆæœŸç”Ÿå¾’ãƒªã‚¹ãƒˆè¡¨ç¤ºï¼ˆå…¨ç”Ÿå¾’ï¼‰
    updateStudentDisplay('all', 'all');
    
    // ã‚¿ãƒ–å‡¦ç†è¨­å®š
    setupTabs();
    
    // å­¦å¹´ã‚¿ãƒ–ã®è¡¨ç¤ºã‚’åˆæœŸåŒ–
    const elementaryGrades = document.querySelectorAll('.elementary-grade');
    const middleGrades = document.querySelectorAll('.middle-grade');
    const highGrades = document.querySelectorAll('.high-grade');

    // åˆæœŸçŠ¶æ…‹ã§ã¯è©³ç´°å­¦å¹´ã‚¿ãƒ–ã‚’éè¡¨ç¤º
    elementaryGrades.forEach(tab => tab.style.display = 'none');
    middleGrades.forEach(tab => tab.style.display = 'none');
    highGrades.forEach(tab => tab.style.display = 'none');

    // å­¦æ ¡ç¨®ã‚¿ãƒ–ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ 
    document.querySelector('.grade-tab[data-grade="elementary"]').addEventListener('click', function() {
        elementaryGrades.forEach(tab => tab.style.display = 'block');
        middleGrades.forEach(tab => tab.style.display = 'none');
        highGrades.forEach(tab => tab.style.display = 'none');
    });

    document.querySelector('.grade-tab[data-grade="middle"]').addEventListener('click', function() {
        elementaryGrades.forEach(tab => tab.style.display = 'none');
        middleGrades.forEach(tab => tab.style.display = 'block');
        highGrades.forEach(tab => tab.style.display = 'none');
    });

    document.querySelector('.grade-tab[data-grade="high"]').addEventListener('click', function() {
        elementaryGrades.forEach(tab => tab.style.display = 'none');
        middleGrades.forEach(tab => tab.style.display = 'none');
        highGrades.forEach(tab => tab.style.display = 'block');
    });

    document.querySelector('.grade-tab[data-grade="all"]').addEventListener('click', function() {
        elementaryGrades.forEach(tab => tab.style.display = 'none');
        middleGrades.forEach(tab => tab.style.display = 'none');
        highGrades.forEach(tab => tab.style.display = 'none');
    });
    
    // ç”Ÿå¾’æ¤œç´¢æ©Ÿèƒ½
    setupStudentSearch();

    // æˆç¸¾å‘ä¸Šãƒ•ã‚£ãƒ«ã‚¿è¨­å®š
    setupImprovementFilter();
    
    // ä¸€æ‹¬å‡ºå¸­ç¢ºèªãƒœã‚¿ãƒ³
    const attendanceCheckBtn = document.getElementById('attendance-check-btn');
    if (attendanceCheckBtn) {
        attendanceCheckBtn.addEventListener('click', function() {
            console.log('ä¸€æ‹¬å‡ºå¸­ç¢ºèªãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');
            
            // ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ç”Ÿå¾’ã®å­¦å¹´ã¨æ›œæ—¥
            const activeGradeTab = document.querySelector('.grade-tab.active');
            const activeDayTab = document.querySelector('.day-tab.active');
            
            const grade = activeGradeTab ? activeGradeTab.dataset.grade : 'all';
            const day = activeDayTab ? activeDayTab.dataset.day : 'all';
            
            console.log(`é¸æŠä¸­ã®å­¦å¹´:${grade}, æ›œæ—¥:${day}`);
            
            // ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
            const filters = {};
            if (grade !== 'all') filters.grade = grade;
            if (day !== 'all') filters.day = day;
            
            fetchStudents(filters)
                .then(students => {
                    console.log(`å‡ºå¸­ç¢ºèªç”¨ã«${students.length}äººã®ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã—ãŸ`);
                    showAttendanceModal(students);
                })
                .catch(error => {
                    console.error('ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                    alert('ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                });
        });
    }
    
    // å‡ºå¸­ãƒ¢ãƒ¼ãƒ€ãƒ«ã®é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
    const attendanceClose = document.querySelector('.attendance-close');
    if (attendanceClose) {
        attendanceClose.addEventListener('click', function() {
            document.getElementById('attendance-modal').style.display = 'none';
        });
    }
    
    // å‡ºå¸­ãƒ¢ãƒ¼ãƒ€ãƒ«ã®é€ä¿¡ãƒœã‚¿ãƒ³å‡¦ç†
    const attendanceSubmitBtn = document.getElementById('attendance-submit-btn');
    if (attendanceSubmitBtn) {
        attendanceSubmitBtn.addEventListener('click', function() {
            console.log('å‡ºå¸­æƒ…å ±ã‚’ä¿å­˜ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');
            
            const dateInput = document.getElementById('attendance-date-input').value;
            const attendanceData = [];
            
            document.querySelectorAll('.attendance-row').forEach(row => {
                const studentId = row.dataset.id;
                const isClassDay = row.dataset.isClassDay === 'true';
                const selectedRadio = row.querySelector(`input[name="attendance-${studentId}"]:checked`);
                const status = selectedRadio ? selectedRadio.value : null;
                
                console.log(`ç”Ÿå¾’ID:${studentId}, çŠ¶æ…‹:${status}, æˆæ¥­æ—¥:${isClassDay}`);
                
                // å‡ºå¸­çŠ¶æ…‹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã ã‘ã‚’é€ä¿¡
                if (status && status !== 'none') {
                    attendanceData.push({
                        student_id: studentId,
                        status: status,
                        date: dateInput,
                        award_points: status === 'present' && isClassDay  // å‡ºå¸­ã‹ã¤æˆæ¥­æ—¥ã®å ´åˆã®ã¿ãƒã‚¤ãƒ³ãƒˆä»˜ä¸
                    });
                }
            });
            
            console.log('é€ä¿¡ã™ã‚‹å‡ºå¸­ãƒ‡ãƒ¼ã‚¿:', attendanceData);
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            this.disabled = true;
            this.textContent = 'ä¿å­˜ä¸­...';
            
            // å®Ÿéš›ã«APIã‚’å‘¼ã³å‡ºã—ã¦ä¿å­˜
            saveAttendanceRecords(attendanceData)
                .then(result => {
                    console.log('å‡ºå¸­è¨˜éŒ²ä¿å­˜çµæœ:', result);
                    
                    // ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚‹å ´åˆã¯è¡¨ç¤º
                    if (result.awarded_points) {
                        let message = `å‡ºå¸­æƒ…å ±ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚`;
                        if (result.awarded_points_count) {
                            message += `${result.awarded_points_count}äººã®ç”Ÿå¾’ã«${result.awarded_points}ãƒã‚¤ãƒ³ãƒˆãŒä»˜ä¸ã•ã‚Œã¾ã—ãŸã€‚`;
                        } else {
                            message += `å„ç”Ÿå¾’ã«${result.awarded_points}ãƒã‚¤ãƒ³ãƒˆãŒä»˜ä¸ã•ã‚Œã¾ã—ãŸã€‚`;
                        }
                        alert(message);
                    } else {
                        alert(result.message || 'å‡ºå¸­æƒ…å ±ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
                    }
                    
                    document.getElementById('attendance-modal').style.display = 'none';
                    
                    // ç”Ÿå¾’ãƒªã‚¹ãƒˆã‚’æ›´æ–°
                    const activeGradeTab = document.querySelector('.grade-tab.active');
                    const activeDayTab = document.querySelector('.day-tab.active');
                    
                    const grade = activeGradeTab ? activeGradeTab.dataset.grade : 'all';
                    const day = activeDayTab ? activeDayTab.dataset.day : 'all';
                    
                    updateStudentDisplay(grade, day);
                })
                .catch(error => {
                    console.error('Error saving attendance:', error);
                    alert('å‡ºå¸­æƒ…å ±ã®ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
                })
                .finally(() => {
                    // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
                    this.disabled = false;
                    this.textContent = 'å‡ºå¸­æƒ…å ±ã‚’ä¿å­˜';
                });
        });
    }
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
    window.addEventListener('click', function(event) {
        const modal = document.getElementById('attendance-modal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
        
        const gradeScheduleModal = document.getElementById('grade-schedule-modal');
        if (event.target === gradeScheduleModal) {
            gradeScheduleModal.style.display = 'none';
        }
    });
    
    // å­¦å¹´åˆ¥æ›œæ—¥è¨­å®šãƒœã‚¿ãƒ³
    const gradeScheduleBtn = document.getElementById('grade-schedule-btn');
    if (gradeScheduleBtn) {
        gradeScheduleBtn.addEventListener('click', function() {
            // å­¦å¹´åˆ¥æ›œæ—¥è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            document.getElementById('grade-schedule-modal').style.display = 'block';
            // è¨­å®šãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
            loadGradeSchedule();
        });
    }
    
    // å­¦å¹´åˆ¥æ›œæ—¥è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã®é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
    const gradeScheduleClose = document.querySelector('.grade-schedule-close');
    if (gradeScheduleClose) {
        gradeScheduleClose.addEventListener('click', function() {
            document.getElementById('grade-schedule-modal').style.display = 'none';
        });
    }
    
    // å­¦å¹´åˆ¥æ›œæ—¥è¨­å®šã®ä¿å­˜ãƒœã‚¿ãƒ³
    const gradeScheduleSaveBtn = document.getElementById('grade-schedule-save-btn');
    if (gradeScheduleSaveBtn) {
        gradeScheduleSaveBtn.addEventListener('click', saveGradeSchedule);
    }
    
    // åˆæœŸçŠ¶æ…‹ã§ã¯ã€å°å­¦ç”Ÿãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’è¡¨ç¤º
    document.querySelector('.filter-tab[data-filter="elementary"]').click();
    
    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®åˆæœŸå€¤ã‚’è¨­å®š
    // å°å­¦ç”Ÿï¼šå‰æœˆã¨ä»Šæœˆã§æ¯”è¼ƒã™ã‚‹ã‚ˆã†ã«åˆæœŸè¨­å®š
    const currentMonth = today.getMonth() + 1; // 0-indexed -> 1-indexed
    const prevMonth = currentMonth == 1 ? 12 : currentMonth - 1;
    
    document.getElementById('elementary-start-month').value = prevMonth;
    document.getElementById('elementary-end-month').value = currentMonth;
    
    // ä¸­å­¦ç”Ÿï¼šåˆæœŸå€¤ã‚’è¨­å®šï¼ˆä¾‹ï¼šåŒã˜å­¦å¹´ã®å‰å­¦æœŸã¨ä»Šå­¦æœŸï¼‰
    // ç¾åœ¨ã®å­¦æœŸã‚’æ¨å®šï¼ˆæ—¥æœ¬ã®ä¸€èˆ¬çš„ãªå­¦æœŸåŒºåˆ†ï¼‰
    let currentTerm = 1;
    if (today.getMonth() >= 4 && today.getMonth() <= 8) { // 5æœˆã€œ9æœˆ
        currentTerm = 1;
    } else if (today.getMonth() >= 9 && today.getMonth() <= 11) { // 10æœˆã€œ12æœˆ
        currentTerm = 2;
    } else { // 1æœˆã€œ4æœˆ
        currentTerm = 3;
    }
    
    const prevTerm = currentTerm === 1 ? 3 : currentTerm - 1;
    const yearForPrevTerm = prevTerm === 3 ? 2 : 3; // 3å­¦æœŸã®å ´åˆã¯å‰ã®å­¦å¹´ã‚’é¸æŠ
    
    document.getElementById('middle-start-year').value = yearForPrevTerm;
    document.getElementById('middle-start-term').value = prevTerm;
    document.getElementById('middle-end-year').value = 3;
    document.getElementById('middle-end-term').value = currentTerm;
});

// Quick Links Enhanced Interactions
document.addEventListener('DOMContentLoaded', function() {
    const quickLinks = document.querySelectorAll('.quick-link');
    
    // ãƒ‘ãƒ©ãƒ©ãƒƒã‚¯ã‚¹åŠ¹æœã¨ãƒã‚¦ã‚¹è¿½å¾“
    quickLinks.forEach((link, index) => {
        // é…å»¶ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
        setTimeout(() => {
            link.style.opacity = '1';
            link.style.transform = 'translateY(0)';
        }, 100 * (index + 1));
        
        // ãƒã‚¦ã‚¹è¿½å¾“åŠ¹æœã‚’ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰
        // link.addEventListener('mousemove', (e) => {
        //     if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
            
        //     const rect = link.getBoundingClientRect();
        //     const centerX = rect.left + rect.width / 2;
        //     const centerY = rect.top + rect.height / 2;
            
        //     const deltaX = (e.clientX - centerX) / rect.width * 10;
        //     const deltaY = (e.clientY - centerY) / rect.height * 10;
            
        //     link.style.transform = `translateY(-8px) scale(1.02) rotateX(${-deltaY}deg) rotateY(${deltaX}deg)`;
        // });
        
        // link.addEventListener('mouseleave', () => {
        //     if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        //         link.style.transform = 'none';
        //     } else {
        //         link.style.transform = 'translateY(0) scale(1) rotateX(0deg) rotateY(0deg)';
        //     }
        // });
        
        // ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
        link.addEventListener('click', (e) => {
            // ãƒªãƒƒãƒ—ãƒ«åŠ¹æœ
            const ripple = document.createElement('div');
            ripple.style.position = 'absolute';
            ripple.style.borderRadius = '50%';
            ripple.style.background = 'rgba(0, 255, 255, 0.6)';
            ripple.style.transform = 'scale(0)';
            /* ripple.style.animation = 'ripple 0.6s linear'; /* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰ */
            ripple.style.pointerEvents = 'none';
            
            const rect = link.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = (e.clientX - rect.left - size / 2) + 'px';
            ripple.style.top = (e.clientY - rect.top - size / 2) + 'px';
            
            link.style.position = 'relative';
            link.appendChild(ripple);
            
            setTimeout(() => {
                ripple.remove();
            }, 600);
        });
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£
        link.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                link.click();
            }
        });
    });
    
    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã®è¦–å·®åŠ¹æœã‚’ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰
    // const observerOptions = {
    //     threshold: [0, 0.25, 0.5, 0.75, 1],
    //     rootMargin: '0px 0px -100px 0px'
    // };
    
    // const quickLinksObserver = new IntersectionObserver((entries) => {
    //     entries.forEach(entry => {
    //         if (entry.isIntersecting) {
    //             const ratio = entry.intersectionRatio;
    //             const element = entry.target;
                
    //             if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
    //                 element.style.opacity = Math.max(0.3, ratio);
    //                 element.style.transform = `translateY(${(1 - ratio) * 20}px)`;
    //             }
    //         }
    //     });
    // }, observerOptions);
    
    // quickLinks.forEach(link => {
    //     quickLinksObserver.observe(link);
    // });
    
    // ãƒªãƒƒãƒ—ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨CSS
    const style = document.createElement('style');
    style.textContent = `
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        .quick-link {
            overflow: hidden;
        }
        
        /* ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– */
        .quick-link {
            will-change: transform, opacity;
            transform: translateZ(0);
        }
        
        /* é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
        @media (prefers-contrast: high) {
            .quick-link {
                border: 2px solid currentColor;
            }
            
            .quick-link .icon {
                filter: none;
                color: currentColor;
            }
        }
        
        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
        @media (prefers-color-scheme: dark) {
            .quick-link {
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
                border-color: rgba(255, 255, 255, 0.1);
            }
        }
        
        /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹è¡¨ç¤ºã®æ”¹å–„ */
        .quick-link:focus-visible {
            outline: 3px solid var(--cyber-primary);
            outline-offset: 2px;
        }
    `;
    document.head.appendChild(style);
    
    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
    if ('requestIdleCallback' in window) {
        requestIdleCallback(() => {
            console.log('Quick Links enhanced interactions loaded');
        });
    }
    
    // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    window.addEventListener('error', (e) => {
        if (e.filename && e.filename.includes('teacher_dashboard')) {
            console.warn('Quick Links interaction error:', e.message);
        }
    });
    
    // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body;
    
    // ä¿å­˜ã•ã‚ŒãŸãƒ†ãƒ¼ãƒã®èª­ã¿è¾¼ã¿
    const savedTheme = localStorage.getItem('dashboardTheme') || 'dark';
    setTheme(savedTheme);
    
    // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    if (themeToggle) {
        themeToggle.addEventListener('click', function() {
            const currentTheme = body.classList.contains('light-mode') ? 'light' : 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
            localStorage.setItem('dashboardTheme', newTheme);
        });
    }
    
    function setTheme(theme) {
        if (theme === 'light') {
            body.classList.add('light-mode');
            body.classList.remove('dark-mode');
            if (themeToggle) {
                themeToggle.querySelector('i').className = 'fas fa-sun';
                themeToggle.setAttribute('title', 'ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ');
            }
        } else {
            body.classList.add('dark-mode');
            body.classList.remove('light-mode');
            if (themeToggle) {
                themeToggle.querySelector('i').className = 'fas fa-moon';
                themeToggle.setAttribute('title', 'ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ');
            }
        }
    }
});
</script>

<style>
/* ãƒ‘ãƒãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼æ”¹å–„ */
.panel-header {
  font-size: 20px;
  font-weight: 600;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-bottom: 15px;
  border-bottom: 1px solid var(--glass-border);
  margin-bottom: 25px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.panel-header-left {
  display: flex;
  align-items: center;
}

.panel-header-icon {
  margin-right: 10px;
  font-size: 24px;
  color: var(--cyber-primary);
  filter: drop-shadow(0 0 5px var(--cyber-primary));
}

/* ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ */
.theme-toggle-btn {
  background: linear-gradient(135deg, var(--glass-bg), rgba(255, 255, 255, 0.1));
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  color: var(--cyber-primary);
  position: relative;
  overflow: hidden;
}

.theme-toggle-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, var(--cyber-primary), var(--neon-pink));
  opacity: 0;
  transition: opacity 0.3s ease;
}

/* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰: theme-toggle-btn hover effects
.theme-toggle-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
}

.theme-toggle-btn:hover::before {
  opacity: 0.1;
}
*/

.theme-toggle-btn i {
  position: relative;
  z-index: 1;
  font-size: 18px;
  transition: all 0.3s ease;
}

/* ç„¡åŠ¹åŒ–ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ï¼‰: theme-toggle-btn i hover effects
.theme-toggle-btn:hover i {
  color: white;
  filter: drop-shadow(0 0 5px currentColor);
}
*/  /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  body.dark-mode .theme-toggle-btn i::before {
    content: '\f185'; /* sun icon */
  }
  
  /* ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰æ™‚ã®è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
  body.light-mode {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%) !important;
    color: #333 !important;
  }
  
  body.light-mode .dashboard-container {
    background: rgba(255, 255, 255, 0.95) !important;
    backdrop-filter: blur(10px) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
  }
  
  body.light-mode .header {
    background: rgba(255, 255, 255, 0.9) !important;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
  }
  
  body.light-mode .header h1 {
    color: #333 !important;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1) !important;
  }
  
  body.light-mode .panel {
    background: rgba(255, 255, 255, 0.8) !important;
    border: 1px solid rgba(0, 0, 0, 0.1) !important;
    color: #333 !important;
  }
  
  body.light-mode .panel-header h2 {
    color: #333 !important;
  }
  
  body.light-mode .quick-link {
    background: rgba(255, 255, 255, 0.7) !important;
    border: 1px solid rgba(0, 0, 0, 0.1) !important;
    color: #333 !important;
  }
  
  body.light-mode .quick-link:hover {
    background: rgba(255, 255, 255, 0.9) !important;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
  }
  
  body.light-mode .quick-link h3 {
    color: #333 !important;
  }
  
  body.light-mode .quick-link p {
    color: #666 !important;
  }
  
  body.light-mode .quick-link .icon {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    color: white !important;
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body;
    
    // ä¿å­˜ã•ã‚ŒãŸãƒ†ãƒ¼ãƒã®èª­ã¿è¾¼ã¿
    const savedTheme = localStorage.getItem('dashboardTheme') || 'dark';
    setTheme(savedTheme);
    
    // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    if (themeToggle) {
        themeToggle.addEventListener('click', function() {
            const currentTheme = body.classList.contains('light-mode') ? 'light' : 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
            localStorage.setItem('dashboardTheme', newTheme);
        });
    }
    
    function setTheme(theme) {
        if (theme === 'light') {
            body.classList.add('light-mode');
            body.classList.remove('dark-mode');
            if (themeToggle) {
                themeToggle.querySelector('i').className = 'fas fa-sun';
                themeToggle.setAttribute('title', 'ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ');
            }
        } else {
            body.classList.add('dark-mode');
            body.classList.remove('light-mode');
            if (themeToggle) {
                themeToggle.querySelector('i').className = 'fas fa-moon';
                themeToggle.setAttribute('title', 'ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ');
            }
        }
    }
});
</script>
{% endblock %}